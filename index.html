<!DOCTYPE html>
<html lang="en" itemscope itemtype="https://schema.org/InsuranceAgency">
<head>
    <!-- === MORTAPPS STUDIOS DIGITAL FINGERPRINT === -->
    <meta name="generator" content="MortApps Studios - Premium Web Solutions Kenya">
    <meta name="author" content="MortApps Studios">
    <meta name="copyright" content="Â© 2024 MortApps Studios. Website crafted with excellence.">
    <meta name="web_author" content="https://mortappsstudios.com">
    <link rel="author" href="https://mortappsstudios.com">
    <link rel="publisher" href="https://mortappsstudios.com">
    <!-- ============================================ -->

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <title>Baba Bima Insurance | Trusted Insurance Solutions Kenya</title>
    <meta name="description" content="Baba Bima Insurance provides comprehensive insurance solutions for individuals and businesses in Kenya. Get affordable Whole of Life, Critical Illness, and Accident insurance today.">
    
    <!-- Schema.org Structured Data for MortApps SEO Boost -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "InsuranceAgency",
        "name": "Baba Bima Insurance",
        "url": "https://www.bababima.co.ke",
        "logo": "https://www.bababima.co.ke/bima.logo.jpg",
        "description": "Trusted Whole of Life Insurance solutions in Kenya",
        "telephone": "+254722460390",
        "address": {
            "@type": "PostalAddress",
            "addressLocality": "Nairobi",
            "addressCountry": "Kenya"
        },
        "provider": {
            "@type": "Organization",
            "name": "MortApps Studios",
            "url": "https://mortappsstudios.com",
            "description": "Premium Web Development for Kenyan Businesses"
        }
    }
    </script>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        /* ===== MORTAPPS STUDIOS SIGNATURE DESIGN SYSTEM ===== */
        :root {
            /* Premium Insurance Color Palette */
            --primary-blue: #1E3A8A;
            --primary-dark: #0F2C6B;
            --primary-light: #3B82F6;
            --accent-gold: #D4AF37;
            --accent-green: #10B981;
            --accent-red: #EF4444;
            --neutral-white: #FFFFFF;
            --neutral-light: #F8FAFC;
            --neutral-gray: #64748B;
            --neutral-dark: #1E293B;
            
            /* Design System */
            --shadow-sm: 0 4px 12px rgba(0, 0, 0, 0.05);
            --shadow-md: 0 10px 30px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 20px 50px rgba(0, 0, 0, 0.12);
            --transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.1);
            --border-radius: 12px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
            scroll-padding-top: 100px;
        }

        body {
            font-family: 'Inter', sans-serif;
            color: var(--neutral-dark);
            line-height: 1.6;
            background-color: var(--neutral-light);
            overflow-x: hidden;
        }

        h1, h2, h3, h4, h5, h6 {
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            line-height: 1.2;
            color: var(--primary-dark);
        }

        .container {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 40px;
        }

        .section-padding {
            padding: 100px 0;
        }

        /* ===== HEADER WITH FIXED MENU SPACING ===== */
        header {
            position: fixed;
            top: 0;
            width: 100%;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            box-shadow: var(--shadow-sm);
            z-index: 1000;
            border-bottom: 1px solid rgba(30, 58, 138, 0.1);
        }

        .nav-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
            text-decoration: none;
        }

        .logo-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-dark));
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: var(--shadow-md);
            overflow: hidden;
            flex-shrink: 0;
        }

        .logo-icon img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            display: block;
        }

        .logo-text h1 {
            font-size: 1.4rem;
            color: var(--primary-blue);
            line-height: 1.1;
        }

        .logo-text span {
            font-size: 0.8rem;
            color: var(--neutral-gray);
            font-weight: 500;
            letter-spacing: 0.5px;
        }

        /* ===== FIXED NAVIGATION MENU - PROPER SPACING ===== */
        .nav-menu {
            display: flex;
            align-items: center;
            gap: 30px;
        }

        .nav-link {
            color: var(--neutral-dark);
            text-decoration: none;
            font-weight: 500;
            font-size: 1rem;
            position: relative;
            transition: var(--transition);
            white-space: nowrap;
            padding: 8px 0;
        }

        .nav-link:hover {
            color: var(--primary-blue);
        }

        .nav-link::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background: linear-gradient(to right, var(--primary-blue), var(--accent-gold));
            transition: var(--transition);
        }

        .nav-link:hover::after {
            width: 100%;
        }

        .nav-cta {
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-dark));
            color: white;
            padding: 10px 24px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 600;
            transition: var(--transition);
            box-shadow: 0 6px 20px rgba(30, 58, 138, 0.2);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.95rem;
            white-space: nowrap;
        }

        .nav-cta:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 25px rgba(30, 58, 138, 0.3);
        }

        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--neutral-dark);
            cursor: pointer;
            z-index: 1001;
        }

        /* ===== MOBILE MENU FIX - PROPER OVERLAY ===== */
        @media (max-width: 1100px) {
            .nav-menu {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(255, 255, 255, 0.98);
                backdrop-filter: blur(10px);
                flex-direction: column;
                padding: 100px 30px 30px;
                gap: 20px;
                z-index: 1000;
                overflow-y: auto;
            }
            
            .nav-menu.active {
                display: flex;
            }
            
            .nav-link {
                font-size: 1.1rem;
                padding: 15px 20px;
                width: 100%;
                text-align: center;
                border-bottom: 1px solid rgba(30, 58, 138, 0.1);
            }
            
            .nav-cta {
                margin-top: 20px;
                justify-content: center;
                padding: 12px 30px;
                width: 100%;
            }
            
            .mobile-menu-btn {
                display: block;
            }
        }

        /* ===== HERO SECTION ===== */
        .hero {
            min-height: 100vh;
            display: flex;
            align-items: center;
            background: linear-gradient(135deg, rgba(30, 58, 138, 0.9), rgba(15, 44, 107, 0.9)),
                        url('https://images.unsplash.com/photo-1554224155-6726b3ff858f?ixlib=rb-4.0.3&auto=format&fit=crop&w=1911&q=80');
            background-size: cover;
            background-position: center;
            color: white;
            padding: 140px 0 80px;
            position: relative;
        }

        .hero::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 150px;
            background: linear-gradient(to top, var(--neutral-light), transparent);
        }

        .hero-content {
            max-width: 800px;
            position: relative;
            z-index: 2;
        }

        .hero-badge {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            padding: 12px 25px;
            border-radius: 50px;
            margin-bottom: 30px;
            border: 1px solid rgba(212, 175, 55, 0.3);
            font-weight: 500;
        }

        .hero-badge i {
            color: var(--accent-gold);
        }

        .hero-title {
            font-size: 3.5rem;
            margin-bottom: 25px;
            line-height: 1.1;
            color: white;
        }

        .hero-title span {
            color: var(--accent-gold);
            display: block;
        }

        .hero-subtitle {
            font-size: 1.3rem;
            margin-bottom: 40px;
            opacity: 0.9;
            max-width: 650px;
            line-height: 1.7;
        }

        .hero-cta {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 16px 36px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 12px;
            transition: var(--transition);
            font-family: 'Montserrat', sans-serif;
            font-size: 1.05rem;
            border: none;
            cursor: pointer;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--accent-gold), #E6B325);
            color: var(--primary-dark);
            box-shadow: 0 8px 25px rgba(212, 175, 55, 0.3);
        }

        .btn-primary:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(212, 175, 55, 0.4);
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-3px);
        }

        /* ===== VIDEO SECTION ===== */
        .video-section {
            padding: 40px 0;
            background: white;
        }

        .video-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 40px;
        }

        .video-wrapper {
            position: relative;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            background: var(--neutral-dark);
        }

        .video-player {
            width: 100%;
            height: auto;
            display: block;
            max-height: 600px;
            object-fit: contain;
            background: #000;
        }

        .video-placeholder {
            width: 100%;
            height: 500px;
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-dark));
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            border-radius: var(--border-radius);
        }

        .video-placeholder i {
            font-size: 4rem;
            margin-bottom: 20px;
            color: var(--accent-gold);
        }

        .video-placeholder p {
            font-size: 1.2rem;
            opacity: 0.9;
            text-align: center;
            max-width: 500px;
            margin: 0 auto;
        }

        .video-loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 1.5rem;
            display: none;
        }

        .video-fallback {
            display: none;
            text-align: center;
            padding: 30px;
            background: rgba(30, 58, 138, 0.1);
            border-radius: var(--border-radius);
            margin-top: 20px;
        }

        .video-fallback a {
            color: var(--primary-blue);
            text-decoration: none;
            font-weight: 600;
        }

        .video-fallback a:hover {
            text-decoration: underline;
        }

        /* ===== PREMIUM ANALYZER SECTION ===== */
        .premium-analyzer {
            background-color: white;
        }

        .section-header {
            text-align: center;
            margin-bottom: 80px;
        }

        .section-title {
            font-size: 3rem;
            margin-bottom: 20px;
            position: relative;
            display: inline-block;
        }

        .section-title::after {
            content: '';
            position: absolute;
            bottom: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 4px;
            background: linear-gradient(to right, var(--primary-blue), var(--accent-gold));
            border-radius: 2px;
        }

        .section-subtitle {
            font-size: 1.2rem;
            color: var(--neutral-gray);
            max-width: 700px;
            margin: 0 auto;
            line-height: 1.7;
        }

        .analyzer-container {
            background: white;
            border-radius: var(--border-radius);
            padding: 60px;
            box-shadow: var(--shadow-lg);
            margin-top: 40px;
        }

        .analyzer-step {
            display: none;
        }

        .analyzer-step.active {
            display: block;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .step-title {
            font-size: 1.8rem;
            margin-bottom: 40px;
            color: var(--primary-dark);
            text-align: center;
        }

        /* Updated coverage breakdown inside analyzer */
        .coverage-inside-analyzer {
            background: rgba(30, 58, 138, 0.03);
            border-radius: var(--border-radius);
            padding: 30px;
            margin-bottom: 40px;
            border: 1px solid rgba(30, 58, 138, 0.1);
        }

        .coverage-inside-analyzer h3 {
            font-size: 1.4rem;
            margin-bottom: 20px;
            color: var(--primary-dark);
            text-align: center;
        }

        .coverage-inside-analyzer p {
            text-align: center;
            color: var(--neutral-gray);
            margin-bottom: 25px;
            font-size: 1rem;
        }

        .coverage-grid-small {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .coverage-item-small {
            background: white;
            border-radius: 8px;
            padding: 15px;
            box-shadow: var(--shadow-sm);
            border-left: 3px solid var(--primary-blue);
        }

        .coverage-amount-small {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--primary-blue);
            margin-bottom: 5px;
        }

        .coverage-title-small {
            font-size: 0.9rem;
            font-weight: 600;
            color: var(--neutral-dark);
            margin-bottom: 5px;
        }

        .coverage-desc-small {
            color: var(--neutral-gray);
            font-size: 0.8rem;
            line-height: 1.4;
        }

        .benefit-summary-small {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            border-top: 3px solid var(--accent-gold);
            font-size: 0.9rem;
            line-height: 1.6;
            color: var(--neutral-gray);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--neutral-dark);
            font-size: 1.1rem;
        }

        .form-control {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid rgba(30, 58, 138, 0.1);
            border-radius: 10px;
            font-size: 1rem;
            font-family: 'Inter', sans-serif;
            transition: var(--transition);
            background: white;
            color: var(--neutral-dark);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-blue);
            box-shadow: 0 0 0 3px rgba(30, 58, 138, 0.1);
        }

        /* Enhanced validation styles */
        .validation-hint {
            font-size: 0.8rem;
            color: var(--neutral-gray);
            margin-top: 5px;
            display: block;
        }

        .valid-hint {
            color: var(--accent-green) !important;
            font-weight: 500;
        }

        .error-hint {
            color: var(--accent-red) !important;
            font-weight: 500;
        }

        .form-control.valid {
            border-color: var(--accent-green);
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%2310B981'%3E%3Cpath d='M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 20px;
            padding-right: 45px;
        }

        .form-control.error {
            border-color: var(--accent-red);
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23EF4444'%3E%3Cpath d='M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z'/%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 20px;
            padding-right: 45px;
        }

        /* Update the error message styles */
        .error-message {
            color: var(--accent-red);
            font-size: 0.85rem;
            margin-top: 5px;
            display: none;
            font-weight: 500;
        }

        .error-message.valid {
            color: var(--accent-green) !important;
        }

        /* Input validation styles */
        .error-message {
            color: var(--accent-red);
            font-size: 0.85rem;
            margin-top: 5px;
            display: none;
        }

        .form-control.error {
            border-color: var(--accent-red);
        }

        .form-control.valid {
            border-color: var(--accent-green);
        }

        /* Additional Coverage (Always Included) */
        .inclusive-coverage {
            background: rgba(16, 185, 129, 0.1);
            padding: 25px;
            border-radius: var(--border-radius);
            border: 2px solid var(--accent-green);
            margin-top: 20px;
        }

        .inclusive-coverage h4 {
            font-size: 1.2rem;
            margin-bottom: 20px;
            color: var(--primary-dark);
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 12px 0;
            border-bottom: 1px solid rgba(30, 58, 138, 0.1);
        }

        .checkbox-item:last-child {
            border-bottom: none;
        }

        .checkbox-item input[type="checkbox"] {
            width: 22px;
            height: 22px;
            accent-color: var(--accent-green);
            cursor: default;
        }

        .checkbox-item input[type="checkbox"]:checked {
            background-color: var(--accent-green);
        }

        .checkbox-label {
            font-weight: 500;
            color: var(--neutral-dark);
        }

        .calculator-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 1px solid rgba(30, 58, 138, 0.1);
        }

        .btn-calculator {
            padding: 14px 32px;
            border-radius: 10px;
            font-weight: 600;
            font-size: 1rem;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            display: flex;
            align-items: center;
            gap: 10px;
            font-family: 'Montserrat', sans-serif;
        }

        .btn-prev {
            background: white;
            color: var(--neutral-dark);
            border: 2px solid rgba(30, 58, 138, 0.1);
        }

        .btn-prev:hover:not(:disabled) {
            background: var(--neutral-light);
            border-color: var(--primary-blue);
            color: var(--primary-blue);
        }

        .btn-prev:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-next, .btn-calculate {
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-dark));
            color: white;
        }

        .btn-next:hover, .btn-calculate:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(30, 58, 138, 0.3);
        }

        /* === PDF BUTTON STYLES === */
        .btn-pdf {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
            color: white;
            padding: 16px 36px;
            border-radius: 50px;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 600;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.05rem;
            transition: var(--transition);
        }

        .btn-pdf:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(220, 38, 38, 0.3);
        }

        .btn-whatsapp {
            background: linear-gradient(135deg, #25D366, #128C7E);
            color: white;
            padding: 16px 36px;
            border-radius: 50px;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 600;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.05rem;
            transition: var(--transition);
        }

        .btn-whatsapp:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 30px rgba(37, 211, 102, 0.3);
        }

        .btn-pdf-disabled {
            background: linear-gradient(135deg, #9ca3af, #6b7280);
            color: #e5e7eb;
            padding: 16px 36px;
            border-radius: 50px;
            border: none;
            cursor: not-allowed;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 600;
            font-family: 'Montserrat', sans-serif;
            font-size: 1.05rem;
            transition: var(--transition);
            opacity: 0.7;
        }

        /* === PDF DOWNLOAD MESSAGE === */
        .pdf-message {
            background: linear-gradient(135deg, rgba(30, 58, 138, 0.05), rgba(212, 175, 55, 0.05));
            border-radius: var(--border-radius);
            padding: 30px;
            margin-top: 30px;
            text-align: center;
            border: 2px solid var(--accent-gold);
            display: none;
        }

        .pdf-message h4 {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: var(--primary-dark);
        }

        .pdf-message p {
            color: var(--neutral-gray);
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .pdf-success {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(16, 185, 129, 0.05));
            border: 2px solid var(--accent-green);
            display: none;
        }

        .pdf-success h4 {
            color: var(--accent-green);
        }

        .action-buttons {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin-top: 40px;
            flex-wrap: wrap;
        }

        /* ===== BABA BIMA SAVINGS PLAN SECTION ===== */
        .savings-plan {
            background: linear-gradient(135deg, var(--neutral-light), white);
        }

        .plan-highlights {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            margin: 50px 0;
        }

        .highlight-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 30px;
            box-shadow: var(--shadow-md);
            border-left: 5px solid var(--accent-gold);
            transition: var(--transition);
        }

        .highlight-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .highlight-card h4 {
            font-size: 1.3rem;
            margin-bottom: 15px;
            color: var(--primary-dark);
        }

        .highlight-card ul {
            list-style: none;
            padding-left: 0;
        }

        .highlight-card li {
            padding: 8px 0;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        .highlight-card li:last-child {
            border-bottom: none;
        }

        .highlight-card li i {
            color: var(--accent-green);
            margin-top: 3px;
        }

        /* ===== INSURANCE PRODUCTS SECTION ===== */
        .insurance-products-section {
            background-color: var(--neutral-light);
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 30px;
            margin-top: 50px;
        }

        .product-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 40px;
            box-shadow: var(--shadow-md);
            transition: var(--transition);
            border-top: 5px solid var(--primary-blue);
            position: relative;
        }

        .product-card:hover {
            transform: translateY(-10px);
            box-shadow: var(--shadow-lg);
            border-top-color: var(--accent-gold);
        }

        .product-icon {
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-dark));
            border-radius: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--accent-gold);
            font-size: 2rem;
            margin-bottom: 25px;
        }

        .product-card h3 {
            font-size: 1.8rem;
            margin-bottom: 15px;
            color: var(--primary-dark);
        }

        .product-card p {
            color: var(--neutral-gray);
            margin-bottom: 25px;
            line-height: 1.6;
        }

        .product-cta {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-dark));
            color: white;
            padding: 12px 28px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 600;
            transition: var(--transition);
            cursor: pointer;
            border: none;
            font-family: 'Montserrat', sans-serif;
        }

        .product-cta:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(30, 58, 138, 0.3);
        }

        /* ===== PRICING TABLE ===== */
        .pricing {
            background-color: white;
        }

        .pricing-table {
            background: white;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            margin-top: 60px;
        }

        .table-header {
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-dark));
            color: white;
            padding: 30px;
            text-align: center;
        }

        .table-header h3 {
            font-size: 2rem;
            margin-bottom: 10px;
            color: white;
        }

        .table-header p {
            opacity: 0.9;
            font-size: 1.1rem;
        }

        .table-content {
            max-height: 600px;
            overflow-y: auto;
        }

        .table-row {
            display: grid;
            grid-template-columns: 50px 2fr 1fr 100px;
            align-items: center;
            padding: 20px 30px;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
            transition: var(--transition);
        }

        .table-row:hover {
            background-color: rgba(30, 58, 138, 0.03);
        }

        .row-number {
            font-weight: 600;
            color: var(--primary-blue);
            font-size: 1.2rem;
        }

        .row-policy {
            font-weight: 500;
            color: var(--neutral-dark);
            font-size: 1.1rem;
        }

        .row-price {
            font-weight: 600;
            color: var(--accent-green);
            font-size: 1.2rem;
        }

        .row-action {
            text-align: center;
        }

        .table-cta {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: linear-gradient(135deg, var(--accent-green), #0DA271);
            color: white;
            padding: 8px 20px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 600;
            font-size: 0.9rem;
            transition: var(--transition);
            white-space: nowrap;
        }

        .table-cta:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(16, 185, 129, 0.3);
        }

        /* ===== BABA BIMA SECTION ===== */
        .bababima-section {
            background: linear-gradient(135deg, var(--neutral-light), white);
        }

        .bababima-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 60px;
            align-items: center;
        }

        .bababima-image {
            position: relative;
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow-lg);
        }

        .bababima-img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            transition: var(--transition);
        }

        .bababima-img:hover {
            transform: scale(1.03);
        }

        .experience-badge {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: linear-gradient(135deg, var(--accent-gold), #E6B325);
            color: var(--primary-dark);
            padding: 15px 25px;
            border-radius: var(--border-radius);
            font-weight: 700;
            font-size: 1.2rem;
            box-shadow: var(--shadow-md);
        }

        .bababima-info h3 {
            font-size: 2.2rem;
            margin-bottom: 20px;
            color: var(--primary-dark);
        }

        .bababima-info p {
            font-size: 1.1rem;
            color: var(--neutral-gray);
            margin-bottom: 25px;
            line-height: 1.8;
        }

        .bababima-brands {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin: 30px 0;
        }

        .brand-tag {
            background: rgba(30, 58, 138, 0.1);
            color: var(--primary-blue);
            padding: 8px 18px;
            border-radius: 50px;
            font-weight: 500;
            font-size: 0.9rem;
        }

        .bababima-cta {
            display: inline-flex;
            align-items: center;
            gap: 12px;
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-dark));
            color: white;
            padding: 14px 32px;
            border-radius: 50px;
            text-decoration: none;
            font-weight: 600;
            transition: var(--transition);
            margin-top: 20px;
        }

        .bababima-cta:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 25px rgba(30, 58, 138, 0.3);
        }

        /* ===== CONTACT SECTION ===== */
        .contact {
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-dark));
            color: white;
        }

        .contact .section-title {
            color: white;
        }

        .contact .section-subtitle {
            color: rgba(255, 255, 255, 0.9);
        }

        .contact-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 50px;
            margin-top: 60px;
        }

        .contact-info h3 {
            font-size: 1.8rem;
            margin-bottom: 25px;
            color: white;
        }

        .contact-details {
            margin-bottom: 40px;
        }

        .contact-item {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 25px;
        }

        .contact-icon {
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--accent-gold);
            font-size: 1.5rem;
            flex-shrink: 0;
        }

        .contact-text h4 {
            font-size: 1.2rem;
            margin-bottom: 5px;
        }

        .contact-text p, .contact-text a {
            color: rgba(255, 255, 255, 0.9);
            text-decoration: none;
            transition: var(--transition);
        }

        .contact-text a:hover {
            color: var(--accent-gold);
        }

        /* ===== FOOTER WITH MORTAPPS STUDIOS BRANDING ===== */
        footer {
            background-color: var(--neutral-dark);
            color: white;
            padding: 80px 0 40px;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 50px;
            margin-bottom: 60px;
        }

        .footer-column h3 {
            font-size: 1.4rem;
            margin-bottom: 30px;
            color: white;
            position: relative;
            padding-bottom: 15px;
        }

        .footer-column h3::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 50px;
            height: 3px;
            background: var(--accent-gold);
        }

        .footer-links {
            list-style: none;
        }

        .footer-links li {
            margin-bottom: 15px;
        }

        .footer-links a {
            color: rgba(255, 255, 255, 0.7);
            text-decoration: none;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .footer-links a:hover {
            color: var(--accent-gold);
            padding-left: 5px;
        }

        .footer-about p {
            color: rgba(255, 255, 255, 0.7);
            margin-bottom: 30px;
            line-height: 1.8;
        }

        .footer-logo {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 25px;
        }

        .footer-logo .logo-icon {
            width: 60px;
            height: 60px;
        }

        .footer-logo h3 {
            font-size: 1.6rem;
            margin: 0;
            padding: 0;
        }

        .footer-logo h3::after {
            display: none;
        }

        /* Social Media Links Styles */
        .social-media-links {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        .social-link {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1.2rem;
            transition: var(--transition);
            text-decoration: none;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .social-link:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-3px);
            border-color: var(--accent-gold);
        }

        .social-link.facebook:hover {
            background: linear-gradient(135deg, #1877F2, #0D5CB6);
            color: white;
        }

        .social-link.instagram:hover {
            background: linear-gradient(45deg, #405DE6, #5851DB, #833AB4, #C13584, #E1306C, #FD1D1D);
            color: white;
        }

        .social-link.tiktok:hover {
            background: linear-gradient(135deg, #000000, #25F4EE, #FE2C55);
            color: white;
        }

        .footer-bottom {
            padding-top: 30px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.95rem;
        }

        .powered-by {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
            padding: 10px 22px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 50px;
            transition: var(--transition);
            text-decoration: none;
            color: rgba(255, 255, 255, 0.7);
        }

        .powered-by:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--accent-gold);
            transform: translateY(-2px);
        }

        .powered-by i {
            color: var(--accent-gold);
        }

        /* === MORTAPPS STUDIOS HIDDEN TRACKING (SEO BOOST) === */
        .mortapps-tracking {
            display: none;
        }
        /* ======================================== */

        /* === Data Privacy Notice === */
        .data-privacy-notice {
            background: rgba(30, 58, 138, 0.05);
            border-left: 4px solid var(--primary-blue);
            padding: 20px;
            margin-top: 30px;
            border-radius: 8px;
            font-size: 0.9rem;
            color: var(--neutral-gray);
            line-height: 1.6;
        }

        .data-privacy-notice strong {
            color: var(--primary-dark);
        }

        /* ===== FLOATING WHATSAPP ===== */
        .floating-whatsapp {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 65px;
            height: 65px;
            background: #25D366;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2rem;
            box-shadow: 0 8px 25px rgba(37, 211, 102, 0.3);
            z-index: 999;
            transition: var(--transition);
            text-decoration: none;
        }

        .floating-whatsapp:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 30px rgba(37, 211, 102, 0.4);
        }

        /* ===== CHATBOT BUTTON (LEFT SIDE) ===== */
        .floating-chatbot {
            position: fixed;
            bottom: 110px;
            left: 30px;
            width: 65px;
            height: 65px;
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-dark));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.8rem;
            box-shadow: 0 8px 25px rgba(30, 58, 138, 0.3);
            z-index: 999;
            transition: var(--transition);
            cursor: pointer;
            border: 2px solid var(--accent-gold);
            animation: pulse 2s infinite;
        }

        .floating-chatbot:hover {
            transform: scale(1.1);
            box-shadow: 0 12px 30px rgba(30, 58, 138, 0.4);
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(30, 58, 138, 0.4); }
            70% { box-shadow: 0 0 0 15px rgba(30, 58, 138, 0); }
            100% { box-shadow: 0 0 0 0 rgba(30, 58, 138, 0); }
        }

        /* ===== AI CHATBOT WIDGET ===== */
        #aiChatWidget {
            display: none;
            position: fixed;
            bottom: 190px;
            left: 30px;
            width: 350px;
            height: 500px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            z-index: 99998;
            border: 2px solid var(--accent-gold);
            overflow: hidden;
            top: auto !important;
        }

        /* Chatbot header with space */
        .chatbot-header {
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-dark));
            color: white;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 70px;
        }

        .chatbot-header h4 {
            margin: 0;
            font-size: 16px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        /* Chat messages container with padding */
        #chatMessages {
            height: 330px;
            overflow-y: auto;
            padding: 20px;
            font-size: 14px;
            display: flex;
            flex-direction: column;
        }

        /* First message styling with proper space */
        .first-message {
            background: #f1f5f9;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
            max-width: 85%;
            word-wrap: break-word;
            margin-top: 10px;
        }

        /* Input area container */
        .chatbot-input-area {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 15px;
            border-top: 1px solid #e2e8f0;
            background: white;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        #chatButton {
            display: none;
        }

        /* Chatbot animations */
        @keyframes blink {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        /* Professional heading styles for chatbot messages */
        .chat-heading {
            font-size: 15px;
            font-weight: 700;
            color: var(--primary-dark);
            margin: 15px 0 8px 0;
            padding-bottom: 5px;
            border-bottom: 2px solid var(--accent-gold);
        }

        .chat-subheading {
            font-size: 14px;
            font-weight: 600;
            color: var(--primary-blue);
            margin: 12px 0 6px 0;
        }

        .chat-section {
            background: rgba(30, 58, 138, 0.03);
            padding: 10px;
            border-radius: 8px;
            margin: 8px 0;
            border-left: 3px solid var(--accent-gold);
        }

        /* Clear button styles */
        #clearChatBtn {
            background: rgba(239,68,68,0.9);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(239,68,68,0.3);
            font-size: 16px;
            flex-shrink: 0;
        }

        #clearChatBtn:hover {
            background: rgba(220,38,38,1);
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(220,38,38,0.4);
        }

        /* Send button styles */
        #sendBtn {
            background: linear-gradient(135deg, var(--primary-blue), var(--primary-dark));
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(30,58,138,0.3);
        }

        #sendBtn:hover {
            transform: scale(1.1);
            box-shadow: 0 5px 15px rgba(30,58,138,0.4);
        }

        /* Chat input styles */
        #chatInput {
            flex: 1;
            min-width: 150px;
            padding: 10px 15px;
            border: 1px solid #cbd5e1;
            border-radius: 25px;
            font-size: 14px;
            outline: none;
        }

        /* Typing indicator */
        #typingIndicator {
            display: none;
            color: var(--neutral-gray);
            font-size: 12px;
            margin-top: 8px;
            padding-left: 10px;
        }

        /* ===== RESPONSIVE DESIGN ===== */
        @media (max-width: 1200px) {
            .container {
                padding: 0 30px;
            }
            
            .nav-menu {
                gap: 25px;
            }
            
            .bababima-content {
                grid-template-columns: 1fr;
                gap: 50px;
            }
            
            .table-row {
                grid-template-columns: 40px 2fr 1fr 90px;
            }
        }

        @media (max-width: 768px) {
            .hero-title {
                font-size: 2.3rem;
            }
            
            .section-title {
                font-size: 2rem;
            }
            
            .hero-cta {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
            }
            
            .products-grid {
                grid-template-columns: 1fr;
            }
            
            .analyzer-container {
                padding: 30px 20px;
            }
            
            .coverage-grid-small {
                grid-template-columns: 1fr;
            }
            
            .calculator-buttons {
                flex-direction: column;
                gap: 15px;
            }
            
            .btn-calculator {
                width: 100%;
                justify-content: center;
            }
            
            .table-row {
                grid-template-columns: 30px 1fr;
                padding: 12px 15px;
            }
            
            .row-price, .row-action {
                grid-column: 1 / -1;
                margin-top: 10px;
                padding-top: 10px;
                border-top: 1px solid rgba(0, 0, 0, 0.1);
            }
            
            .row-action {
                text-align: left;
            }
            
            .floating-whatsapp {
                bottom: 20px;
                right: 20px;
                width: 55px;
                height: 55px;
                font-size: 1.8rem;
            }
            
            .floating-chatbot {
                bottom: 90px;
                left: 20px;
                width: 55px;
                height: 55px;
                font-size: 1.6rem;
            }
            
            #aiChatWidget {
                bottom: 160px;
                left: 20px;
                width: calc(100% - 40px);
                max-width: 400px;
                height: 450px;
            }
            
            /* Mobile adjustments for chatbot */
            #chatMessages {
                height: 280px;
            }
            
            .chatbot-header {
                height: 60px;
                padding: 15px;
            }
            
            .bababima-content {
                gap: 40px;
            }
            
            .experience-badge {
                position: relative;
                bottom: 0;
                left: 0;
                margin-top: 20px;
                width: 100%;
                text-align: center;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .btn-whatsapp, .btn-pdf, .btn-pdf-disabled {
                width: 100%;
                justify-content: center;
            }
            
            .pdf-message {
                padding: 20px;
            }

            /* Mobile chatbot input */
            .chatbot-input-area {
                padding: 12px;
                gap: 8px;
            }
            
            #chatInput {
                font-size: 13px;
                padding: 10px 12px;
                min-width: 120px;
            }
            
            #clearChatBtn, #sendBtn {
                width: 38px;
                height: 38px;
                font-size: 15px;
            }
            
            .first-message {
                padding: 12px;
                font-size: 13px;
            }
            
            .user-message, .bot-message {
                padding: 10px 14px;
                font-size: 13px;
                max-width: 90%;
            }
            
            .chat-heading {
                font-size: 14px;
            }
            
            .chat-subheading {
                font-size: 13px;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 0 20px;
            }
            
            .hero-title {
                font-size: 2rem;
            }
            
            .section-title {
                font-size: 1.8rem;
            }
            
            .product-card {
                padding: 25px;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .footer-content {
                grid-template-columns: 1fr;
            }
            
            .floating-whatsapp {
                bottom: 15px;
                right: 15px;
                width: 50px;
                height: 50px;
                font-size: 1.6rem;
            }
            
            .floating-chatbot {
                bottom: 80px;
                left: 15px;
                width: 50px;
                height: 50px;
                font-size: 1.5rem;
            }
            
            #aiChatWidget {
                bottom: 150px;
                left: 15px;
                width: calc(100% - 30px);
                max-width: 300px;
                height: 400px;
            }
            
            /* Mobile adjustments for chatbot */
            #chatMessages {
                height: 230px;
            }
            
            .chatbot-header {
                height: 55px;
                padding: 12px 15px;
            }
            
            .chatbot-header h4 {
                font-size: 14px;
            }

            /* Very small screens */
            @media (max-width: 380px) {
                #chatInput {
                    min-width: 100px;
                    font-size: 12px;
                    padding: 9px 11px;
                }
                
                .chatbot-input-area {
                    gap: 6px;
                }
                
                #clearChatBtn, #sendBtn {
                    width: 36px;
                    height: 36px;
                    font-size: 14px;
                }
            }
        }
    </style>
</head>
<body>
    <!-- === HEADER WITH FIXED MENU SPACING === -->
    <header itemscope itemtype="https://schema.org/InsuranceAgency">
        <div class="container nav-container">
            <a href="#home" class="logo" itemprop="url">
                <div class="logo-icon" itemprop="logo">
                    <img src="bima.logo.jpg" alt="Baba Bima Insurance Logo" loading="eager">
                </div>
                <div class="logo-text">
                    <h1 itemprop="name">BABA BIMA INSURANCE</h1>
                    <span itemprop="description">Trusted Insurance Solutions</span>
                </div>
            </a>
            
            <nav class="nav-menu" id="navMenu">
                <a href="#home" class="nav-link" itemprop="mainEntityOfPage">Home</a>
                <a href="#analyzer" class="nav-link">Premium Analyzer</a>
                <a href="#products" class="nav-link">Insurance Products</a>
                <a href="#pricing" class="nav-link">Pricing</a>
                <a href="#bababima" class="nav-link">About Baba Bima</a>
                <a href="#contact" class="nav-link">Contact</a>
                <a href="tel:+254722460390" class="nav-cta" itemprop="telephone">
                    <i class="fas fa-phone-alt"></i> +254 722 460 390
                </a>
            </nav>
            
            <button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="Toggle navigation">
                <i class="fas fa-bars"></i>
            </button>
        </div>
    </header>

    <!-- === HERO SECTION === -->
    <section class="hero" id="home">
        <div class="container">
            <div class="hero-content">
                <div class="hero-badge">
                    <i class="fas fa-shield-alt"></i>
                    <span>Trusted Since 1990</span>
                </div>
                <h1 class="hero-title">Lifetime Protection <span>Enhanced with Critical Illness & Accident Cover</span></h1>
                <p class="hero-subtitle">
                    Baba Bima Whole of Life Insurance provides comprehensive lifetime protection with enhanced benefits for accidents and critical illness coverage. Get accurate premium estimates based on your age and desired coverage amount.
                </p>
                <div class="hero-cta">
                    <a href="https://wa.me/254722460390" class="btn btn-primary">
                        <i class="fab fa-whatsapp"></i> Get Free Insurance Quote
                    </a>
                    <a href="#analyzer" class="btn btn-secondary">
                        <i class="fas fa-calculator"></i> Calculate Your Premium
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- === VIDEO SECTION (NEW) === -->
    <section class="video-section">
        <div class="video-container">
            <div class="video-wrapper">
                <video class="video-player" controls playsinline preload="metadata" poster="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIwMCIgaGVpZ2h0PSI2MDAiIHZpZXdCb3g9IjAgMCAxMjAwIDYwMCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjEyMDAiIGhlaWdodD0iNjAwIiBmaWxsPSIjMUUzQThBIi8+CjxwYXRoIGQ9Ik0zMDAgMjUwTDUwMCAzNTBMNzAwIDI1MCIgc3Ryb2tlPSIjRDRBRjM3IiBzdHJva2Utd2lkdGg9IjEwIiBzdHJva2UtbGluZWNhcD0icm91bmQiIHN0cm9rZS1saW5lam9pbj0icm91bmQiLz4KPC9zdmc+">
                    <source src="/vidz/bbmi-vid1.mp4" type="video/mp4">
                    Your browser does not support the video tag.
                </video>
                <div class="video-loading" id="videoLoading">
                    <i class="fas fa-spinner fa-spin"></i> Loading video...
                </div>
            </div>
            <div class="video-fallback" id="videoFallback">
                <p>If the video doesn't load, you can <a href="/vidz/bbmi-vid1.mp4" download>download it here</a> or contact us for assistance.</p>
            </div>
        </div>
    </section>

    <!-- === PREMIUM ANALYZER SECTION === -->
    <section class="premium-analyzer section-padding" id="analyzer">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">Premium Analyzer</h2>
                <p class="section-subtitle">
                    Get an accurate Whole of Life Insurance premium estimate in just 3 simple steps. Our calculator uses official insurance rate cards to provide precise monthly premium figures for a 10-year payment period.
                </p>
            </div>
            
            <!-- Updated coverage breakdown as per Word document -->
            <div class="coverage-inside-analyzer">
                <h3>Your Coverage Breakdown</h3>
                <p>For every KES 5,000,000 in Sum Assured, you receive these comprehensive benefits:</p>
                
                <div class="coverage-grid-small">
                    <div class="coverage-item-small">
                        <div class="coverage-amount-small">KES 5,000,000</div>
                        <div class="coverage-title-small">Sum Assured (Basic Coverage)</div>
                        <p class="coverage-desc-small">Your core protection amount - the foundation of your insurance policy.</p>
                    </div>
                    
                    <div class="coverage-item-small">
                        <div class="coverage-amount-small">2% Annual Bonus</div>
                        <div class="coverage-title-small">Annual Bonus on Sum Assured</div>
                        <p class="coverage-desc-small">The sum insured earns 2% bonus on the main policy sum assured (annually).</p>
                    </div>
                    
                    <div class="coverage-item-small">
                        <div class="coverage-amount-small">KES 5,000,000</div>
                        <div class="coverage-title-small">Total & Permanent Disability</div>
                        <p class="coverage-desc-small">100% Sum assured paid for severe dismemberment due to accident (before age 65).</p>
                    </div>
                    
                    <div class="coverage-item-small">
                        <div class="coverage-amount-small">KES 2,500,000</div>
                        <div class="coverage-title-small">Critical Illness Benefit</div>
                        <p class="coverage-desc-small">50% of sum assured (Max 15M) paid on first diagnosis + waiver on future premiums.</p>
                    </div>
                    
                    <div class="coverage-item-small">
                        <div class="coverage-amount-small">KES 5,000,000 + Bonus</div>
                        <div class="coverage-title-small">Natural Death Benefit</div>
                        <p class="coverage-desc-small">100% sum assured plus bonuses paid to beneficiaries for natural death.</p>
                    </div>
                    
                    <div class="coverage-item-small">
                        <div class="coverage-amount-small">KES 10,000,000 + Bonus</div>
                        <div class="coverage-title-small">Accidental Death Benefit</div>
                        <p class="coverage-desc-small">200% of sum assured plus accrued bonuses for accidental death.</p>
                    </div>
                </div>
                
                <div class="benefit-summary-small">
                    This whole life plan provides lifetime protection with enhanced benefits for accidents and support for critical illness diagnoses, ensuring comprehensive coverage for you and stress-free life for your family.
                </div>
            </div>
            
            <div class="analyzer-container">
                <!-- Step 1 -->
                <div class="analyzer-step active" id="step1">
                    <h3 class="step-title">Personal Information</h3>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">First Name</label>
                            <input type="text" class="form-control" id="analyzerName" placeholder="Enter your first name" required>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Age</label>
                            <select class="form-control" id="analyzerAge" required>
                                <option value="">Select your age</option>
                                <option value="18">18 years</option>
                                <option value="19">19 years</option>
                                <option value="20">20 years</option>
                                <option value="21">21 years</option>
                                <option value="22">22 years</option>
                                <option value="23">23 years</option>
                                <option value="24">24 years</option>
                                <option value="25">25 years</option>
                                <option value="26">26 years</option>
                                <option value="27">27 years</option>
                                <option value="28">28 years</option>
                                <option value="29">29 years</option>
                                <option value="30">30 years</option>
                                <option value="31">31 years</option>
                                <option value="32">32 years</option>
                                <option value="33">33 years</option>
                                <option value="34">34 years</option>
                                <option value="35">35 years</option>
                                <option value="36">36 years</option>
                                <option value="37">37 years</option>
                                <option value="38">38 years</option>
                                <option value="39">39 years</option>
                                <option value="40">40 years</option>
                                <option value="41">41 years</option>
                                <option value="42">42 years</option>
                                <option value="43">43 years</option>
                                <option value="44">44 years</option>
                                <option value="45">45 years</option>
                                <option value="46">46 years</option>
                                <option value="47">47 years</option>
                                <option value="48">48 years</option>
                                <option value="49">49 years</option>
                                <option value="50">50 years</option>
                                <option value="51">51 years</option>
                                <option value="52">52 years</option>
                                <option value="53">53 years</option>
                                <option value="54">54 years</option>
                                <option value="55">55 years</option>
                                <option value="56">56 years</option>
                                <option value="57">57 years</option>
                                <option value="58">58 years</option>
                                <option value="59">59 years</option>
                                <option value="60">60 years</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Insurance Type</label>
                            <select class="form-control" id="analyzerType" required>
                                <option value="">Select insurance type</option>
                                <option value="whole_life">Whole of Life Insurance</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Cover Amount (KES)</label>
                            <select class="form-control" id="analyzerAmount" required>
                                <option value="">Select cover amount</option>
                                <option value="2000000">KES 2,000,000</option>
                                <option value="3000000">KES 3,000,000</option>
                                <option value="4000000">KES 4,000,000</option>
                                <option value="5000000">KES 5,000,000</option>
                                <option value="6000000">KES 6,000,000</option>
                                <option value="7000000">KES 7,000,000</option>
                                <option value="8000000">KES 8,000,000</option>
                                <option value="9000000">KES 9,000,000</option>
                                <option value="10000000">KES 10,000,000</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- Step 2 -->
                <div class="analyzer-step" id="step2">
                    <h3 class="step-title">Health & Lifestyle Information</h3>
                    <p style="text-align: center; color: var(--neutral-gray); margin-bottom: 30px; font-size: 1rem;">
                        <i>This information helps us understand your profile better. It does NOT affect the premium calculation below.</i>
                    </p>
                    
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">Do you smoke?</label>
                            <select class="form-control" id="analyzerSmoke" required>
                                <option value="">Select option</option>
                                <option value="no">No, I don't smoke</option>
                                <option value="yes">Yes, I smoke</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Health Status</label>
                            <select class="form-control" id="analyzerHealth" required>
                                <option value="">Select health status</option>
                                <option value="excellent">Excellent - No health issues</option>
                                <option value="good">Good - Minor issues, well-managed</option>
                                <option value="fair">Fair - Some health concerns</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Premium Payment Period</label>
                            <select class="form-control" id="analyzerPaymentPeriod" required>
                                <option value="10">10 Years (Standard)</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Additional Coverage (Inclusive) -->
                    <div class="inclusive-coverage">
                        <h4>Additional Coverage (Inclusive)</h4>
                        <div class="checkbox-item">
                            <input type="checkbox" id="analyzerAnnualBonus" checked disabled>
                            <label for="analyzerAnnualBonus" class="checkbox-label">
                                <i class="fas fa-check-circle" style="color: var(--accent-green);"></i>
                                Annual Bonus (2%) on Sum Assured
                            </label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="analyzerPermanentDisability" checked disabled>
                            <label for="analyzerPermanentDisability" class="checkbox-label">
                                <i class="fas fa-check-circle" style="color: var(--accent-green);"></i>
                                Total and Permanent Disability
                            </label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="analyzerCriticalIllness" checked disabled>
                            <label for="analyzerCriticalIllness" class="checkbox-label">
                                <i class="fas fa-check-circle" style="color: var(--accent-green);"></i>
                                Critical Illness Cover
                            </label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="analyzerAccidentalDeath" checked disabled>
                            <label for="analyzerAccidentalDeath" class="checkbox-label">
                                <i class="fas fa-check-circle" style="color: var(--accent-green);"></i>
                                Accidental Death Benefit
                            </label>
                        </div>
                    </div>
                </div>
                
                <!-- Step 3 (UPDATED WITH ENHANCED VALIDATION) -->
                <div class="analyzer-step" id="step3">
                    <h3 class="step-title">Contact Information</h3>
                    <p style="text-align: center; color: var(--neutral-gray); margin-bottom: 30px; font-size: 1rem;">
                        <i>We require valid contact information to provide you with accurate insurance quotes.</i>
                    </p>
                    
                    <div class="form-grid">
                        <!-- Phone number is NOW MANDATORY with enhanced validation -->
                        <div class="form-group">
                            <label class="form-label">Phone Number <span style="color: var(--accent-red);">*</span></label>
                            <input type="tel" class="form-control" id="analyzerPhone" 
                                   placeholder="e.g. 0712 345 678 or +254712345678" 
                                   required
                                   pattern="^(\+254|0)[17]\d{8}$"
                                   title="Enter a valid Kenyan mobile number">
                            <div class="error-message" id="phoneError">
                                Please enter a valid Kenyan phone number from Safaricom, Airtel, or Telkom
                            </div>
                            <div class="validation-hint" id="phoneHint">
                                Format: 07XXXXXXXX or +2547XXXXXXXX
                            </div>
                        </div>
                        
                        <!-- Email address is NOW MANDATORY with enhanced validation -->
                        <div class="form-group">
                            <label class="form-label">Email Address <span style="color: var(--accent-red);">*</span></label>
                            <input type="email" class="form-control" id="analyzerEmail" 
                                   placeholder="your.real-email@example.com" 
                                   required
                                   pattern="^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$"
                                   title="Enter a valid email address">
                            <div class="error-message" id="emailError">
                                Please enter a valid email address
                            </div>
                            <div class="validation-hint" id="emailHint">
                                Required for verification
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Preferred Contact Method</label>
                            <select class="form-control" id="analyzerContactMethod">
                                <option value="whatsapp">WhatsApp</option>
                                <option value="call">Phone Call</option>
                                <option value="email">Email</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Enhanced validation notice -->
                    <div style="background: rgba(30, 58, 138, 0.05); padding: 15px; border-radius: 8px; margin-top: 20px; border-left: 3px solid var(--accent-gold);">
                        <p style="color: var(--neutral-dark); font-size: 0.9rem; margin: 0;">
                            <strong>Note:</strong> We verify all contact information to ensure accurate service. 
                            Fake or temporary contact details will prevent you from receiving your insurance analysis.
                        </p>
                    </div>
                </div>
                
                <!-- Results Section (UPDATED WITH PDF BUTTON AND BACK BUTTON) -->
                <div class="analyzer-step" id="results" style="display: none;">
                    <h3 class="step-title">Your Premium Analysis</h3>
                    <div id="analysisResults" style="background: var(--neutral-light); padding: 30px; border-radius: var(--border-radius);">
                        <p>Your analysis will appear here...</p>
                    </div>
                    
                    <!-- PDF Download Message -->
                    <div class="pdf-message" id="pdfMessage">
                        <h4>ð Download Your Analysis Report</h4>
                        <p>To download your analysis report as a PDF, please first share it with Baba Bima via WhatsApp. This ensures we can follow up with you personally and provide the best service.</p>
                        <div class="action-buttons">
                            <button class="btn-whatsapp" id="whatsappResultsFirst">
                                <i class="fab fa-whatsapp"></i> First, Send Analysis via WhatsApp
                            </button>
                        </div>
                    </div>
                    
                    <!-- PDF Success Message -->
                    <div class="pdf-message pdf-success" id="pdfSuccess">
                        <h4>â Analysis Shared Successfully!</h4>
                        <p>Thank you for sharing your analysis with Baba Bima. You can now download your detailed PDF report.</p>
                        <div class="action-buttons">
                            <button class="btn-pdf" id="pdfDownloadBtn">
                                <i class="fas fa-file-pdf"></i> Download PDF Report
                            </button>
                        </div>
                    </div>
                    
                    <!-- Data Privacy Notice -->
                    <div class="data-privacy-notice">
                        <strong>Data Privacy Notice:</strong> Your information is used solely to generate this insurance analysis. We do not store, sell, or share your personal data with third parties. All calculations are performed locally on your device for your privacy and security.
                    </div>
                    
                    <div class="action-buttons">
                        <button class="btn-whatsapp" id="whatsappResults">
                            <i class="fab fa-whatsapp"></i> Send Analysis via WhatsApp
                        </button>
                        <button class="btn-pdf-disabled" id="pdfDownloadBtnDisabled" disabled>
                            <i class="fas fa-file-pdf"></i> Download PDF Report (Share First)
                        </button>
                        <!-- Back to Calculator Button -->
                        <button class="btn-calculator btn-prev" id="backToCalculatorBtn">
                            <i class="fas fa-chevron-left"></i> Back to Calculator
                        </button>
                    </div>
                </div>
                
                <div class="calculator-buttons">
                    <button class="btn-calculator btn-prev" id="prevBtn" disabled>
                        <i class="fas fa-chevron-left"></i> Previous
                    </button>
                    <button class="btn-calculator btn-next" id="nextBtn">
                        Next <i class="fas fa-chevron-right"></i>
                    </button>
                    <button class="btn-calculator btn-calculate" id="calculateBtn" style="display: none;">
                        <i class="fas fa-chart-line"></i> Calculate Premium
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- === WHY CHOOSE WHOLE OF LIFE INSURANCE SECTION === -->
    <section class="savings-plan section-padding" id="savings">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">Why Choose Whole of Life Insurance?</h2>
                <p class="section-subtitle">
                    Lifetime protection with guaranteed benefits and enhanced coverage for unexpected events.
                </p>
            </div>
            
            <div style="background: white; padding: 40px; border-radius: var(--border-radius); margin-bottom: 50px; box-shadow: var(--shadow-md);">
                <h3 style="font-size: 1.6rem; margin-bottom: 20px; color: var(--primary-dark);">Comprehensive Lifetime Protection</h3>
                <p style="color: var(--neutral-gray); margin-bottom: 25px; line-height: 1.7;">
                    Whole of Life Insurance provides lifetime coverage that never expires as long as premiums are paid. Unlike term insurance, this policy earns annual bonuses and provides permanent protection for your family's financial security.
                </p>
                <p style="color: var(--neutral-gray); line-height: 1.7;">
                    With built-in Critical Illness and Accidental Death benefits, you get enhanced protection against life's uncertainties while securing your family's future.
                </p>
            </div>
            
            <div class="plan-highlights">
                <div class="highlight-card">
                    <h4>Core Benefits</h4>
                    <ul>
                        <li><i class="fas fa-check"></i> Lifetime coverage that never expires</li>
                        <li><i class="fas fa-check"></i> Bonus cash value accumulation over time</li>
                        <li><i class="fas fa-check"></i> Fixed premiums that never increase</li>
                        <li><i class="fas fa-check"></i> Tax-free death benefits to beneficiaries</li>
                    </ul>
                </div>
                
                <div class="highlight-card">
                    <h4>Enhanced Protection</h4>
                    <ul>
                        <li><i class="fas fa-shield-alt"></i> Critical Illness cover included</li>
                        <li><i class="fas fa-shield-alt"></i> Accidental death benefit included</li>
                        <li><i class="fas fa-shield-alt"></i> Permanent disability coverage</li>
                    </ul>
                </div>
                
                <div class="highlight-card">
                    <h4>Financial Advantages</h4>
                    <ul>
                        <li><i class="fas fa-percentage"></i> Up to 15% insurance tax relief</li>
                        <li><i class="fas fa-chart-line"></i> Guaranteed cash value growth</li>
                        <li><i class="fas fa-hand-holding-usd"></i> Estate planning benefits</li>
                        <li><i class="fas fa-university"></i> Collateral for loans</li>
                    </ul>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 50px;">
                <a href="https://wa.me/254722460390?text=Hello!%20I'm%20interested%20in%20Whole%20of%20Life%20Insurance%20with%20critical%20illness%20and%20accident%20cover." class="product-cta">
                    <i class="fab fa-whatsapp"></i> Get Complete Policy Details
                </a>
            </div>
        </div>
    </section>

    <!-- === INSURANCE PRODUCTS SECTION === -->
    <section class="insurance-products-section section-padding" id="products">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">Our Insurance Solutions</h2>
                <p class="section-subtitle">
                    Specialized insurance products designed for comprehensive protection and financial security.
                </p>
            </div>
            
            <div class="products-grid">
                <!-- Whole of Life Insurance -->
                <div class="product-card">
                    <div class="product-icon">
                        <i class="fas fa-user-shield"></i>
                    </div>
                    <h3>Whole of Life Insurance</h3>
                    <p>Lifetime protection with built-in critical illness and accidental death benefits. Never expires as long as premiums are paid, with cash value accumulation.</p>
                    <div style="margin: 25px 0;">
                        <p><strong>Cover:</strong> From KES 1M - 150M</p>
                        <p><strong>Entry Age:</strong> 18-60 years</p>
                        <p><strong>Benefits:</strong> Lifetime cover + Critical Illness + Accident</p>
                        <p><strong>Premium Payment Options:</strong> Entire life, Up to age 60/65 (if 55 or younger), 10, 15, or 20 years.</p>
                    </div>
                    <button class="product-cta" onclick="window.location.href='https://wa.me/254722460390?text=Hello!%20I\'m%20interested%20in%20Whole%20of%20Life%20Insurance.'">
                        <i class="fab fa-whatsapp"></i> Get Quote
                    </button>
                </div>
                
                <!-- Critical Illness Care -->
                <div class="product-card">
                    <div class="product-icon">
                        <i class="fas fa-heartbeat"></i>
                    </div>
                    <h3>Critical Illness Care</h3>
                    <p>Standalone critical illness coverage for comprehensive protection against major health conditions. Lump-sum payout upon diagnosis.</p>
                    <div style="margin: 25px 0;">
                        <p><strong>Cover:</strong> KES 1M - KES 15M</p>
                        <p><strong>Age:</strong> 18â60 years (up to 65)</p>
                        <p><strong>Conditions:</strong> 40+ covered illnesses</p>
                    </div>
                    <button class="product-cta" onclick="window.location.href='https://wa.me/254722460390?text=Hello!%20I\'m%20interested%20in%20Critical%20Illness%20Care.'">
                        <i class="fab fa-whatsapp"></i> Get Quote
                    </button>
                </div>
                
                <!-- Term Life Insurance -->
                <div class="product-card">
                    <div class="product-icon">
                        <i class="fas fa-hand-holding-heart"></i>
                    </div>
                    <h3>Term Life Insurance</h3>
                    <p>Affordable temporary protection for specific periods. Ideal for mortgage protection, business loans, or family income replacement.</p>
                    <div style="margin: 25px 0;">
                        <p><strong>Cover:</strong> KES 1M - KES 150M</p>
                        <p><strong>Term:</strong> 1â25 years</p>
                        <p><strong>Benefits:</strong> Death, TPD, Critical Illness options</p>
                    </div>
                    <button class="product-cta" onclick="window.location.href='https://wa.me/254722460390?text=Hello!%20I\'m%20interested%20in%20Term%20Life%20Insurance.'">
                        <i class="fab fa-whatsapp"></i> Get Quote
                    </button>
                </div>
            </div>
        </div>
    </section>

    <!-- === PRICING TABLE === -->
    <section class="pricing section-padding" id="pricing">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">Whole of Life Insurance Pricing</h2>
                <p class="section-subtitle">
                    Official monthly premium rates for Whole of Life Insurance with Critical Illness and Accident cover (10-year payment period). Premiums are based on exact age and sum assured.
                </p>
            </div>
            
            <div class="pricing-table">
                <div class="table-header">
                    <h3>Whole of Life Insurance Premiums</h3>
                    <p>Monthly Premiums (KES) - 10-Year Payment Period - Includes Critical Illness & Accident Cover</p>
                </div>
                <div class="table-content">
                    <!-- Premiums will be dynamically generated from Excel data -->
                    <div class="table-row" style="background-color: rgba(30, 58, 138, 0.05); font-weight: 600;">
                        <div class="row-number">Age</div>
                        <div class="row-policy">Sum Assured Options</div>
                        <div class="row-price">Sample: KES 5M Cover</div>
                        <div class="row-action">Get Quote</div>
                    </div>
                    
                    <!-- Sample rows will be populated by JavaScript -->
                    <div id="premiumTableContent">
                        <!-- Premium table will be dynamically generated -->
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- === BABA BIMA SECTION (UPDATED CONTENT) === -->
    <section class="bababima-section section-padding" id="bababima">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">About Baba Bima</h2>
                <p class="section-subtitle">
                    Your trusted partner for comprehensive insurance solutions in Kenya
                </p>
            </div>
            
            <div class="bababima-content">
                <div class="bababima-image">
                    <img src="https://miltonmuriithi.com/wp-content/uploads/2025/07/MkM.jpg" alt="Baba Bima Insurance Advisor" class="bababima-img">
                    <div class="experience-badge">
                        35+ Years Experience
                    </div>
                </div>
                <div class="bababima-info">
                    <h3>Your Trusted Insurance Advisor</h3>
                    <p>
                        Baba Bima team leader - Milton Muriithi is a trusted insurance and financial planning professional with over 35 years of experience helping individuals, families, retirees, and businesses protect their income, wealth, and legacy.
                    </p>
                    <p>
                        As the founder of Diaspora Family Services, Baba Bima, Diaspora Insurance Intermediaries, and Golden Sunset Welfare, he is driven by a clear purpose: to make insurance simple, accessible, and meaningful for everyday people.
                    </p>
                    <p>
                        Built on integrity, clarity, and client-first service, Milton's approach combines practical advice with modern digital tools to deliver reliable protection wherever clients are.
                    </p>
                    
                    <div class="bababima-brands">
                        <span class="brand-tag">Diaspora Family Services</span>
                        <span class="brand-tag">Baba Bima</span>
                        <span class="brand-tag">Diaspora Insurance Intermediaries</span>
                        <span class="brand-tag">Golden Sunset Welfare</span>
                    </div>
                    
                    <a href="https://miltonmuriithi.com" target="_blank" class="bababima-cta">
                        <i class="fas fa-external-link-alt"></i> Learn More
                    </a>
                </div>
            </div>
        </div>
    </section>

    <!-- === CONTACT SECTION === -->
    <section class="contact section-padding" id="contact">
        <div class="container">
            <div class="section-header">
                <h2 class="section-title">Get Covered Today</h2>
                <p class="section-subtitle">
                    Protect what matters most â today and tomorrow. Contact us for personalized insurance solutions.
                </p>
            </div>
            
            <div class="contact-content">
                <div class="contact-info">
                    <h3>Contact Information</h3>
                    <div class="contact-details">
                        <div class="contact-item">
                            <div class="contact-icon">
                                <i class="fas fa-phone-alt"></i>
                            </div>
                            <div class="contact-text">
                                <h4>Call / WhatsApp</h4>
                                <a href="tel:+254722460390">+254 722 460 390</a>
                            </div>
                        </div>
                        
                        <div class="contact-item">
                            <div class="contact-icon">
                                <i class="fab fa-whatsapp"></i>
                            </div>
                            <div class="contact-text">
                                <h4>WhatsApp Business</h4>
                                <a href="https://wa.me/254722460390">+254 722 460 390</a>
                            </div>
                        </div>
                        
                        <div class="contact-item">
                            <div class="contact-icon">
                                <i class="fas fa-envelope"></i>
                            </div>
                            <div class="contact-text">
                                <h4>Email Address</h4>
                                <a href="mailto:bababimainsurance@gmail.com">bababimainsurance@gmail.com</a>
                            </div>
                        </div>
                        
                        <div class="contact-item">
                            <div class="contact-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="contact-text">
                                <h4>Business Hours</h4>
                                <p>24/7 Service Available</p>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div style="background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); border-radius: var(--border-radius); padding: 40px; border: 1px solid rgba(255, 255, 255, 0.2);">
                    <h3 style="font-size: 1.8rem; margin-bottom: 25px; color: white;">Why Choose Baba Bima?</h3>
                    <ul style="list-style: none;">
                        <li style="padding: 12px 0; border-bottom: 1px solid rgba(255, 255, 255, 0.1); display: flex; align-items: center; gap: 15px;">
                            <i class="fas fa-check-circle" style="color: var(--accent-gold);"></i>
                            Trusted insurance solutions with 35+ years experience
                        </li>
                        <li style="padding: 12px 0; border-bottom: 1px solid rgba(255, 255, 255, 0.1); display: flex; align-items: center; gap: 15px;">
                            <i class="fas fa-check-circle" style="color: var(--accent-gold);"></i>
                            Accurate premium calculations based on official rate cards
                        </li>
                        <li style="padding: 12px 0; border-bottom: 1px solid rgba(255, 255, 255, 0.1); display: flex; align-items: center; gap: 15px;">
                            <i class="fas fa-check-circle" style="color: var(--accent-gold);"></i>
                            Comprehensive Whole of Life Insurance with enhanced benefits
                        </li>
                        <li style="padding: 12px 0; display: flex; align-items: center; gap: 15px;">
                            <i class="fas fa-check-circle" style="color: var(--accent-gold);"></i>
                            Backed by a giant multinational insurer with presence in over 40 countries worldwide
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </section>

    <!-- === FOOTER WITH MORTAPPS STUDIOS BRANDING === -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-column">
                    <div class="footer-logo">
                        <div class="logo-icon">
                            <img src="bima.logo.jpg" alt="Baba Bima Insurance Logo" loading="eager">
                        </div>
                        <h3>Baba Bima Insurance</h3>
                    </div>
                    <div class="footer-about">
                        <p>Providing trusted Whole of Life Insurance solutions for individuals and families across Kenya. With over 35 years of experience, we make insurance simple, accessible, and meaningful.</p>
                    </div>
                    <!-- Social Media Links -->
                    <div class="social-media-links">
                        <a href="https://web.facebook.com/profile.php?id=61586087081659" target="_blank" class="social-link facebook" aria-label="Visit our Facebook page">
                            <i class="fab fa-facebook-f"></i>
                        </a>
                        <a href="https://www.instagram.com/bababima.ke?igsh=emFsdDVzOTh6eHl0" target="_blank" class="social-link instagram" aria-label="Visit our Instagram page">
                            <i class="fab fa-instagram"></i>
                        </a>
                        <a href="https://www.tiktok.com/@bababimakenya" target="_blank" class="social-link tiktok" aria-label="Visit our TikTok page">
                            <i class="fab fa-tiktok"></i>
                        </a>
                    </div>
                </div>
                
                <div class="footer-column">
                    <h3>Quick Links</h3>
                    <ul class="footer-links">
                        <li><a href="#home"><i class="fas fa-chevron-right"></i> Home</a></li>
                        <li><a href="#analyzer"><i class="fas fa-chevron-right"></i> Premium Analyzer</a></li>
                        <li><a href="#savings"><i class="fas fa-chevron-right"></i> Why Choose Whole Life</a></li>
                        <li><a href="#products"><i class="fas fa-chevron-right"></i> Insurance Products</a></li>
                        <li><a href="#bababima"><i class="fas fa-chevron-right"></i> About Baba Bima</a></li>
                        <li><a href="#contact"><i class="fas fa-chevron-right"></i> Contact</a></li>
                    </ul>
                </div>
                
                <div class="footer-column">
                    <h3>Contact Info</h3>
                    <ul class="footer-links">
                        <li><a href="tel:+254722460390"><i class="fas fa-phone"></i> +254 722 460 390</a></li>
                        <li><a href="https://wa.me/254722460390"><i class="fab fa-whatsapp"></i> WhatsApp</a></li>
                        <li><a href="mailto:bababimainsurance@gmail.com"><i class="fas fa-envelope"></i> bababimainsurance@gmail.com</a></li>
                        <li><a href="https://miltonmuriithi.com"><i class="fas fa-external-link-alt"></i> Milton Muriithi</a></li>
                    </ul>
                </div>
            </div>
            
            <div class="footer-bottom">
                <p>&copy; 2025 Baba Bima Insurance. All rights reserved. | Trusted Insurance Solutions Since 1990</p>
                <!-- === MORTAPPS STUDIOS BRANDING === -->
                <a href="https://mortappsstudios.com" target="_blank" rel="noopener" class="powered-by" aria-label="Website developed by MortApps Studios">
                    <i class="fas fa-code"></i>
                    <span>Powered By MortApps Studios</span>
                </a>
                <!-- ================================== -->
            </div>
        </div>
    </footer>

    <!-- === FLOATING WHATSAPP === -->
    <a href="https://wa.me/254722460390?text=Hello%20Baba%20Bima%20Insurance!%20I%20saw%20your%20website%20and%20I'm%20interested%20in%20getting%20a%20Whole%20of%20Life%20Insurance%20quote." class="floating-whatsapp" aria-label="Chat with us on WhatsApp">
        <i class="fab fa-whatsapp"></i>
    </a>

    <!-- === FLOATING CHATBOT (LEFT SIDE) === -->
    <div class="floating-chatbot" id="floatingChatbotButton" aria-label="Chat with Milton AI Assistant">
        <i class="fas fa-robot"></i>
    </div>

    <!-- === INTELLIGENT AI CHATBOT - COMPLETE VERSION === -->
    <div id="aiChatWidget" style="display:none;">
        <!-- Chatbot header -->
        <div class="chatbot-header">
            <h4><i class="fas fa-robot" style="color:var(--accent-gold)"></i> Milton AI Assistant</h4>
            <button id="closeChat" style="background:none;border:none;color:white;font-size:20px;cursor:pointer">Ã</button>
        </div>
        
        <!-- Chat messages container -->
        <div id="chatMessages">
            <!-- FIRST MESSAGE WITH PROPER SPACE -->
            <div class="first-message">
                <strong>Milton AI:</strong> Hello! I'm your intelligent insurance assistant created by MortApps Studios. I can answer detailed questions about Baba Bima's Whole Life Insurance, premiums, coverage, and more. What would you like to know?
            </div>
        </div>
        
        <!-- Input area with clear button next to send button -->
        <div class="chatbot-input-area">
            <button id="clearChatBtn" title="Clear chat history">
                <i class="fas fa-trash-alt"></i>
            </button>
            <input type="text" id="chatInput" placeholder="Ask anything about insurance...">
            <button id="sendBtn">
                <i class="fas fa-paper-plane"></i>
            </button>
            <div id="typingIndicator" style="display:none;">
                <i class="fas fa-circle" style="font-size:6px;animation:blink 1.4s infinite"></i>
                <i class="fas fa-circle" style="font-size:6px;animation:blink 1.4s infinite 0.2s"></i>
                <i class="fas fa-circle" style="font-size:6px;animation:blink 1.4s infinite 0.4s"></i>
                Milton is typing...
            </div>
        </div>
    </div>

    <!-- === MORTAPPS STUDIOS HIDDEN TRACKING (SEO BOOST) === -->
    <div class="mortapps-tracking" aria-hidden="true">
        <meta name="mortapps-client" content="Baba Bima Insurance">
        <meta name="mortapps-industry" content="Whole of Life Insurance">
        <meta name="mortapps-date" content="2024">
        <link rel="mortapps-portfolio" href="https://mortappsstudios.com/portfolio/bababima">
    </div>

    <!-- PDF Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <script>
        // ========================================================
        // === COMPLETE WEBSITE FUNCTIONALITY INCLUDING CHATBOT ===
        // ========================================================

        // === VIDEO HANDLING FUNCTIONALITY ===
        function initVideoPlayer() {
            const video = document.querySelector('.video-player');
            const videoLoading = document.getElementById('videoLoading');
            const videoFallback = document.getElementById('videoFallback');
            
            if (video) {
                // Show loading indicator
                videoLoading.style.display = 'block';
                
                // Video error handling
                video.onerror = function() {
                    videoLoading.style.display = 'none';
                    videoFallback.style.display = 'block';
                    console.log('Video failed to load. Check the path: /vidz/bbmi-vid1.mp4');
                };
                
                // Video loaded successfully
                video.onloadeddata = function() {
                    videoLoading.style.display = 'none';
                    console.log('Video loaded successfully');
                };
                
                // Video waiting/buffering
                video.onwaiting = function() {
                    videoLoading.style.display = 'block';
                };
                
                // Video can play
                video.oncanplay = function() {
                    videoLoading.style.display = 'none';
                };
                
                // Try to load the video
                video.load();
            }
        }

        // === ENHANCED VALIDATION FUNCTIONS ===
        const kenyanCarrierPrefixes = {
            'Safaricom Mobile': ['701', '702', '703', '704', '705', '706', '707', '708', '709',
                                '710', '711', '712', '713', '714', '715', '716', '717', '718', '719',
                                '740', '741', '742', '743', '744', '745', '746', '747', '748', '749',
                                '768', '769', '790', '791', '792', '793'],
            'Airtel Mobile': ['730', '731', '732', '733', '734', '735', '736', '737', '738', '739',
                             '750', '751', '752', '753', '754', '755', '756', '757', '758', '759',
                             '780', '781', '782', '783', '784', '785', '786', '787', '788', '789'],
            'Telkom Mobile': ['770', '771', '772', '773', '774', '775', '776', '777', '778', '779'],
            'Safaricom Landline': ['011', '020', '040', '041', '042', '043', '044', '045', '046', '049', 
                                  '050', '051', '052', '053', '054', '055', '056', '057', '058', '059',
                                  '060', '061', '062', '063', '064', '065', '066', '067', '068', '069'],
            'Airtel Landline': ['070'],
            'Telkom Landline': ['071', '072', '073', '075']
        };

        function isValidKenyanPhone(phone) {
            const cleaned = phone.replace(/[\s\-+]/g, '');
            if (cleaned.length < 9) return false;
            
            let kenyanNumber;
            if (cleaned.startsWith('254')) {
                kenyanNumber = '0' + cleaned.substring(3);
            } else if (cleaned.startsWith('0')) {
                kenyanNumber = cleaned;
            } else {
                return false;
            }
            
            if (!/^0[124567]\d{7,8}$/.test(kenyanNumber)) return false;
            
            const prefix = kenyanNumber.substring(0, 3);
            let validCarrier = false;
            for (const carrier in kenyanCarrierPrefixes) {
                if (kenyanCarrierPrefixes[carrier].includes(prefix)) {
                    validCarrier = true;
                    break;
                }
            }
            
            return validCarrier;
        }

        function isValidEmail(email) {
            const emailRegex = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
            return emailRegex.test(email);
        }

        function isSuspiciousNumber(phone) {
            const cleaned = phone.replace(/[\s\-+]/g, '');
            if (/0123456789/.test(cleaned) || /9876543210/.test(cleaned)) return true;
            if (/(\d)\1{7,}/.test(cleaned)) return true;
            if (cleaned.includes('123456') || cleaned.includes('654321')) return true;
            if (/^0+$/.test(cleaned) || /^1+$/.test(cleaned)) return true;
            return false;
        }

        function isSuspiciousEmail(email) {
            if (/^(test|demo|fake|example|invalid)@/i.test(email)) return true;
            const localPart = email.split('@')[0];
            if (localPart.length < 2) return true;
            return false;
        }

        function validateStep3() {
            const phone = document.getElementById('analyzerPhone').value.trim();
            const email = document.getElementById('analyzerEmail').value.trim();
            const phoneError = document.getElementById('phoneError');
            const emailError = document.getElementById('emailError');
            const phoneField = document.getElementById('analyzerPhone');
            const emailField = document.getElementById('analyzerEmail');
            
            let isValid = true;
            
            phoneError.style.display = 'none';
            emailError.style.display = 'none';
            phoneField.classList.remove('error', 'valid');
            emailField.classList.remove('error', 'valid');
            
            if (!phone) {
                phoneError.textContent = 'Phone number is required';
                phoneError.style.display = 'block';
                phoneError.classList.remove('valid');
                phoneError.classList.add('error');
                phoneField.classList.add('error');
                isValid = false;
            } else {
                if (!isValidKenyanPhone(phone)) {
                    phoneError.textContent = 'Please enter a valid Kenyan phone number (mobile or landline)';
                    phoneError.style.display = 'block';
                    phoneError.classList.remove('valid');
                    phoneError.classList.add('error');
                    phoneField.classList.add('error');
                    isValid = false;
                } else if (isSuspiciousNumber(phone)) {
                    phoneError.textContent = 'Please enter your real phone number';
                    phoneError.style.display = 'block';
                    phoneError.classList.remove('valid');
                    phoneError.classList.add('error');
                    phoneField.classList.add('error');
                    isValid = false;
                } else {
                    phoneError.textContent = 'â Valid Kenyan number';
                    phoneError.style.display = 'block';
                    phoneError.classList.remove('error');
                    phoneError.classList.add('valid');
                    phoneField.classList.remove('error');
                    phoneField.classList.add('valid');
                }
            }
            
            if (!email) {
                emailError.textContent = 'Email address is required';
                emailError.style.display = 'block';
                emailError.classList.remove('valid');
                emailError.classList.add('error');
                emailField.classList.add('error');
                isValid = false;
            } else {
                if (!isValidEmail(email)) {
                    emailError.textContent = 'Please enter a valid email address';
                    emailError.style.display = 'block';
                    emailError.classList.remove('valid');
                    emailError.classList.add('error');
                    emailField.classList.add('error');
                    isValid = false;
                } else if (isSuspiciousEmail(email)) {
                    emailError.textContent = 'Please enter a valid email address';
                    emailError.style.display = 'block';
                    emailError.classList.remove('valid');
                    emailError.classList.add('error');
                    emailField.classList.add('error');
                    isValid = false;
                } else {
                    emailError.textContent = 'â Valid email address';
                    emailError.style.display = 'block';
                    emailError.classList.remove('error');
                    emailError.classList.add('valid');
                    emailField.classList.remove('error');
                    emailField.classList.add('valid');
                }
            }
            
            return isValid;
        }

        function setupRealTimeValidation() {
            const phoneField = document.getElementById('analyzerPhone');
            const emailField = document.getElementById('analyzerEmail');
            const phoneError = document.getElementById('phoneError');
            const emailError = document.getElementById('emailError');
            
            document.getElementById('phoneHint').textContent = 'Format: 07XXXXXXXX or 0XX XXXXXXX or +254...';
            
            phoneField.addEventListener('input', function() {
                const phone = phoneField.value.trim();
                if (!phone) {
                    phoneError.style.display = 'none';
                    phoneField.classList.remove('error', 'valid');
                    return;
                }
                
                if (!isValidKenyanPhone(phone) || isSuspiciousNumber(phone)) {
                    phoneError.textContent = 'Enter a valid Kenyan number';
                    phoneError.style.display = 'block';
                    phoneError.classList.remove('valid');
                    phoneError.classList.add('error');
                    phoneField.classList.remove('valid');
                    phoneField.classList.add('error');
                } else {
                    phoneError.textContent = 'â Valid Kenyan number';
                    phoneError.style.display = 'block';
                    phoneError.classList.remove('error');
                    phoneError.classList.add('valid');
                    phoneField.classList.remove('error');
                    phoneField.classList.add('valid');
                }
            });
            
            emailField.addEventListener('input', function() {
                const email = emailField.value.trim();
                if (!email) {
                    emailError.style.display = 'none';
                    emailField.classList.remove('error', 'valid');
                    return;
                }
                
                if (!isValidEmail(email) || isSuspiciousEmail(email)) {
                    emailError.textContent = 'Enter a valid email address';
                    emailError.style.display = 'block';
                    emailError.classList.remove('valid');
                    emailError.classList.add('error');
                    emailField.classList.remove('valid');
                    emailField.classList.add('error');
                } else {
                    emailError.textContent = 'â Valid email address';
                    emailError.style.display = 'block';
                    emailError.classList.remove('error');
                    emailError.classList.add('valid');
                    emailField.classList.remove('error');
                    emailField.classList.add('valid');
                }
            });
        }

        // === PREMIUM ANALYZER FUNCTIONALITY ===
        const premiumData = {
            18: {2000000: 3395, 3000000: 4117, 4000000: 4914, 5000000: 5800, 6000000: 6488, 7000000: 7217, 8000000: 7991, 9000000: 8815, 10000000: 9692},
            19: {2000000: 3395, 3000000: 4117, 4000000: 4914, 5000000: 5800, 6000000: 6488, 7000000: 7217, 8000000: 7991, 9000000: 8815, 10000000: 9692},
            20: {2000000: 3395, 3000000: 4117, 4000000: 4914, 5000000: 5800, 6000000: 6488, 7000000: 7217, 8000000: 7991, 9000000: 8815, 10000000: 9692},
            21: {2000000: 3395, 3000000: 4117, 4000000: 4914, 5000000: 5800, 6000000: 6488, 7000000: 7217, 8000000: 7991, 9000000: 8815, 10000000: 9692},
            22: {2000000: 3425, 3000000: 4163, 4000000: 4981, 5000000: 5892, 6000000: 6597, 7000000: 7346, 8000000: 8142, 9000000: 8991, 10000000: 9897},
            23: {2000000: 3455, 3000000: 4210, 4000000: 5049, 5000000: 5987, 6000000: 6709, 7000000: 7478, 8000000: 8297, 9000000: 9171, 10000000: 10107},
            24: {2000000: 3486, 3000000: 4257, 4000000: 5118, 5000000: 6084, 6000000: 6824, 7000000: 7613, 8000000: 8456, 9000000: 9357, 10000000: 10324},
            25: {2000000: 3520, 3000000: 4309, 4000000: 5193, 5000000: 6188, 6000000: 6947, 7000000: 7757, 8000000: 8623, 9000000: 9552, 10000000: 10550},
            26: {2000000: 3534, 3000000: 4332, 4000000: 5229, 5000000: 6245, 6000000: 7013, 7000000: 7834, 8000000: 8715, 9000000: 9662, 10000000: 10682},
            27: {2000000: 3569, 3000000: 4385, 4000000: 5307, 5000000: 6355, 6000000: 7142, 7000000: 7985, 8000000: 8892, 9000000: 9868, 10000000: 10922},
            28: {2000000: 3604, 3000000: 4439, 4000000: 5386, 5000000: 6467, 6000000: 7274, 7000000: 8140, 8000000: 9073, 9000000: 10080, 10000000: 11168},
            29: {2000000: 3619, 3000000: 4464, 4000000: 5427, 5000000: 6531, 6000000: 7348, 7000000: 8229, 8000000: 9180, 9000000: 10208, 10000000: 11322},
            30: {2000000: 3655, 3000000: 4520, 4000000: 5509, 5000000: 6648, 6000000: 7487, 7000000: 8392, 8000000: 9371, 9000000: 10431, 10000000: 11583},
            31: {2000000: 3722, 3000000: 4621, 4000000: 5656, 5000000: 6855, 6000000: 7729, 7000000: 8674, 8000000: 9699, 9000000: 10813, 10000000: 12025},
            32: {2000000: 3791, 3000000: 4726, 4000000: 5809, 5000000: 7071, 6000000: 7981, 7000000: 8969, 8000000: 10043, 9000000: 11212, 10000000: 12489},
            33: {2000000: 3861, 3000000: 4833, 4000000: 5966, 5000000: 7294, 6000000: 8244, 7000000: 9276, 8000000: 10401, 9000000: 11630, 10000000: 12975},
            34: {2000000: 3933, 3000000: 4943, 4000000: 6128, 5000000: 7527, 6000000: 8517, 7000000: 9596, 8000000: 10776, 9000000: 12068, 10000000: 13485},
            35: {2000000: 4006, 3000000: 5056, 4000000: 6296, 5000000: 7768, 6000000: 8801, 7000000: 9930, 8000000: 11167, 9000000: 12525, 10000000: 14020},
            36: {2000000: 4081, 3000000: 5173, 4000000: 6469, 5000000: 8018, 6000000: 9096, 7000000: 10278, 8000000: 11576, 9000000: 13004, 10000000: 14580},
            37: {2000000: 4218, 3000000: 5378, 4000000: 6764, 5000000: 8431, 6000000: 9579, 7000000: 10841, 8000000: 12229, 9000000: 13761, 10000000: 15454},
            38: {2000000: 4359, 3000000: 5590, 4000000: 7070, 5000000: 8863, 6000000: 10086, 7000000: 11432, 8000000: 12917, 9000000: 14559, 10000000: 16378},
            39: {2000000: 4504, 3000000: 5810, 4000000: 7389, 5000000: 9315, 6000000: 10617, 7000000: 12053, 8000000: 13641, 9000000: 15401, 10000000: 17355},
            40: {2000000: 4673, 3000000: 6067, 4000000: 7761, 5000000: 9839, 6000000: 11235, 7000000: 12776, 8000000: 14484, 9000000: 16379, 10000000: 18487},
            41: {2000000: 4826, 3000000: 6302, 4000000: 8107, 5000000: 10336, 6000000: 11820, 7000000: 13463, 8000000: 15287, 9000000: 17317, 10000000: 19579},
            42: {2000000: 4984, 3000000: 6545, 4000000: 8467, 5000000: 10857, 6000000: 12434, 7000000: 14185, 8000000: 16134, 9000000: 18307, 10000000: 20734},
            43: {2000000: 5210, 3000000: 6881, 4000000: 8951, 5000000: 11539, 6000000: 13234, 7000000: 15118, 8000000: 17217, 9000000: 19562, 10000000: 22185},
            44: {2000000: 5444, 3000000: 7231, 4000000: 9458, 5000000: 12259, 6000000: 14078, 7000000: 16103, 8000000: 18363, 9000000: 20891, 10000000: 23725},
            45: {2000000: 5685, 3000000: 7595, 4000000: 9988, 5000000: 13018, 6000000: 14969, 7000000: 17144, 8000000: 19576, 9000000: 22301, 10000000: 25360},
            46: {2000000: 5956, 3000000: 8005, 4000000: 10585, 5000000: 13868, 6000000: 15969, 7000000: 18315, 8000000: 20940, 9000000: 23886, 10000000: 27198},
            47: {2000000: 6216, 3000000: 8400, 4000000: 11167, 5000000: 14712, 6000000: 16962, 7000000: 19479, 8000000: 22301, 9000000: 25472, 10000000: 29044},
            48: {2000000: 6505, 3000000: 8842, 4000000: 11819, 5000000: 15653, 6000000: 18072, 7000000: 20781, 8000000: 23823, 9000000: 27246, 10000000: 31108},
            49: {2000000: 6886, 3000000: 9407, 4000000: 12633, 5000000: 16808, 6000000: 19425, 7000000: 22359, 8000000: 25656, 9000000: 29370, 10000000: 33563},
            50: {2000000: 7282, 3000000: 9999, 4000000: 13490, 5000000: 18030, 6000000: 20859, 7000000: 24032, 8000000: 27602, 9000000: 31627, 10000000: 36177},
            51: {2000000: 7696, 3000000: 10620, 4000000: 14393, 5000000: 19325, 6000000: 22379, 7000000: 25809, 8000000: 29670, 9000000: 34030, 10000000: 38962},
            52: {2000000: 8128, 3000000: 11270, 4000000: 15345, 5000000: 20699, 6000000: 23993, 7000000: 27696, 8000000: 31869, 9000000: 36587, 10000000: 41931},
            53: {2000000: 8599, 3000000: 11982, 4000000: 16389, 5000000: 22206, 6000000: 25766, 7000000: 29771, 8000000: 34290, 9000000: 39403, 10000000: 45199},
            54: {2000000: 9110, 3000000: 12757, 4000000: 17528, 5000000: 23854, 6000000: 27706, 7000000: 32044, 8000000: 36942, 9000000: 42488, 10000000: 48782},
            55: {2000000: 9612, 3000000: 13501, 4000000: 18624, 5000000: 25464, 6000000: 29586, 7000000: 34238, 8000000: 39503, 9000000: 45477, 10000000: 52269},
            56: {2000000: 10769, 3000000: 15228, 4000000: 21045, 5000000: 28757, 6000000: 33483, 7000000: 38787, 8000000: 44761, 9000000: 51511, 10000000: 59157},
            57: {2000000: 11820, 3000000: 16802, 4000000: 23275, 5000000: 31838, 6000000: 37122, 7000000: 43038, 8000000: 49686, 9000000: 57182, 10000000: 65660},
            58: {2000000: 13049, 3000000: 18645, 4000000: 25880, 5000000: 35420, 6000000: 41359, 7000000: 47989, 8000000: 55419, 9000000: 63777, 10000000: 73210},
            59: {2000000: 14459, 3000000: 20764, 4000000: 28868, 5000000: 39514, 6000000: 46208, 7000000: 53657, 8000000: 61981, 9000000: 71319, 10000000: 81834},
            60: {2000000: 16091, 3000000: 23222, 4000000: 32326, 5000000: 44234, 6000000: 51805, 7000000: 60201, 8000000: 69553, 9000000: 80015, 10000000: 91765}
        };

        let currentStep = 1;
        const totalSteps = 3;
        let userData = {};
        let hasSharedViaWhatsApp = false;

        function initAnalyzer() {
            document.getElementById('prevBtn').addEventListener('click', goToPreviousStep);
            document.getElementById('nextBtn').addEventListener('click', goToNextStep);
            document.getElementById('calculateBtn').addEventListener('click', calculateResults);
            document.getElementById('whatsappResults').addEventListener('click', sendToWhatsApp);
            document.getElementById('whatsappResultsFirst').addEventListener('click', sendToWhatsApp);
            document.getElementById('pdfDownloadBtn').addEventListener('click', generatePDF);
            document.getElementById('backToCalculatorBtn').addEventListener('click', goBackToCalculator);
            
            document.getElementById('analyzerAnnualBonus').checked = true;
            document.getElementById('analyzerPermanentDisability').checked = true;
            document.getElementById('analyzerCriticalIllness').checked = true;
            document.getElementById('analyzerAccidentalDeath').checked = true;
            
            setupRealTimeValidation();
            updateStepDisplay();
            generatePremiumTable();
        }

        function generatePremiumTable() {
            const tableContent = document.getElementById('premiumTableContent');
            let html = '';
            
            const sampleAges = [25, 35, 45, 55];
            
            sampleAges.forEach(age => {
                const premium = premiumData[age] ? premiumData[age][5000000] : 'N/A';
                html += `
                    <div class="table-row">
                        <div class="row-number">${age}</div>
                        <div class="row-policy">KES 2M, 3M, 4M, 5M, 6M, 7M, 8M, 9M, 10M</div>
                        <div class="row-price">KES ${premium ? premium.toLocaleString() : 'N/A'}</div>
                        <div class="row-action">
                            <a href="https://wa.me/254722460390?text=Hello!%20I'm%20interested%20in%20Whole%20of%20Life%20Insurance%20at%20age%20${age}%20with%20KES%205M%20cover%20(10-year%20payment%20period)." class="table-cta">
                                <i class="fab fa-whatsapp"></i> Quote
                            </a>
                        </div>
                    </div>
                `;
            });
            
            tableContent.innerHTML = html;
        }

        function goToPreviousStep() {
            if (currentStep > 1) {
                currentStep--;
                updateStepDisplay();
            }
        }

        function goToNextStep() {
            if (currentStep === 3) {
                if (!validateStep3()) return;
            }
            
            if (validateCurrentStep()) {
                saveStepData();
                if (currentStep < totalSteps) {
                    currentStep++;
                    updateStepDisplay();
                }
            }
        }

        function validateCurrentStep() {
            const currentStepElement = document.getElementById(`step${currentStep}`);
            const requiredFields = currentStepElement.querySelectorAll('[required]');
            
            for (const field of requiredFields) {
                if (!field.value.trim()) {
                    alert(`Please fill in the ${field.previousElementSibling.textContent} field.`);
                    field.focus();
                    return false;
                }
            }
            
            return true;
        }

        function saveStepData() {
            const currentStepElement = document.getElementById(`step${currentStep}`);
            const inputs = currentStepElement.querySelectorAll('input, select');
            
            inputs.forEach(input => {
                if (input.type === 'checkbox') {
                    userData[input.id] = input.checked;
                } else {
                    userData[input.id] = input.value;
                }
            });
        }

        function updateStepDisplay() {
            for (let i = 1; i <= totalSteps + 1; i++) {
                const step = document.getElementById(`step${i}`);
                if (step) step.style.display = 'none';
            }
            
            document.getElementById(`step${currentStep}`).style.display = 'block';
            
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const calculateBtn = document.getElementById('calculateBtn');
            
            prevBtn.disabled = currentStep === 1;
            
            if (currentStep === totalSteps) {
                nextBtn.style.display = 'none';
                calculateBtn.style.display = 'flex';
            } else {
                nextBtn.style.display = 'flex';
                calculateBtn.style.display = 'none';
            }
            
            document.getElementById('results').style.display = 'none';
        }

        function calculateResults() {
            if (currentStep === 3 && !validateStep3()) return;
            if (!validateCurrentStep()) return;
            saveStepData();
            
            const age = parseInt(userData.analyzerAge);
            const amount = parseInt(userData.analyzerAmount);
            
            let monthlyPremium = 0;
            
            if (premiumData[age] && premiumData[age][amount]) {
                monthlyPremium = premiumData[age][amount];
            }
            
            displayResults(monthlyPremium, amount, age);
        }

        function displayResults(monthly, amount, age) {
            document.getElementById(`step${currentStep}`).style.display = 'none';
            document.getElementById('results').style.display = 'block';
            
            const sumAssured = amount;
            const annualBonus = Math.round(sumAssured * 0.02);
            const totalPermanentDisability = sumAssured;
            const criticalIllness = Math.round(sumAssured * 0.5);
            const naturalDeath = sumAssured;
            const accidentalDeath = sumAssured * 2;
            
            const resultsHTML = `
                <div style="text-align: center;">
                    <h4 style="font-size: 1.2rem; color: var(--primary-dark); margin-bottom: 20px;">Your Whole of Life Insurance Premium Analysis</h4>
                    
                    <div style="background: white; padding: 30px; border-radius: 10px; box-shadow: var(--shadow-sm); margin-bottom: 30px; max-width: 400px; margin-left: auto; margin-right: auto;">
                        <h5 style="color: var(--neutral-gray); margin-bottom: 10px; font-size: 1.1rem;">Your Monthly Premium</h5>
                        <p style="font-size: 2.2rem; font-weight: 700; color: var(--primary-dark); margin: 20px 0;">KES ${monthly.toLocaleString()}</p>
                        <p style="color: var(--neutral-gray); font-size: 0.9rem; margin-top: 10px;">
                            Based on age ${age} and sum assured of KES ${(amount/1000000).toFixed(0)}M<br>
                            10-year payment period
                        </p>
                    </div>
                    
                    <div style="background: white; padding: 25px; border-radius: 10px; box-shadow: var(--shadow-sm); margin-bottom: 20px; text-align: left;">
                        <h5 style="color: var(--primary-dark); margin-bottom: 15px; font-size: 1.1rem;">Your Coverage Breakdown for KES ${(amount/1000000).toFixed(0)}M Sum Assured:</h5>
                        
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                            <div>
                                <div style="font-weight: 600; color: var(--primary-blue);">KES ${sumAssured.toLocaleString()}</div>
                                <div style="font-size: 0.9rem; color: var(--neutral-gray);">Sum Assured (Basic Coverage)</div>
                            </div>
                            
                            <div>
                                <div style="font-weight: 600; color: var(--primary-blue);">KES ${annualBonus.toLocaleString()}/yr</div>
                                <div style="font-size: 0.9rem; color: var(--neutral-gray);">Annual Bonus (2%)</div>
                            </div>
                            
                            <div>
                                <div style="font-weight: 600; color: var(--primary-blue);">KES ${totalPermanentDisability.toLocaleString()}</div>
                                <div style="font-size: 0.9rem; color: var(--neutral-gray);">Total & Permanent Disability</div>
                            </div>
                            
                            <div>
                                <div style="font-weight: 600; color: var(--primary-blue);">KES ${criticalIllness.toLocaleString()}</div>
                                <div style="font-size: 0.9rem; color: var(--neutral-gray);">Critical Illness Benefit</div>
                            </div>
                            
                            <div>
                                <div style="font-weight: 600; color: var(--primary-blue);">KES ${naturalDeath.toLocaleString()}</div>
                                <div style="font-size: 0.9rem; color: var(--neutral-gray);">Natural Death Benefit</div>
                            </div>
                            
                            <div>
                                <div style="font-weight: 600; color: var(--primary-blue);">KES ${accidentalDeath.toLocaleString()}</div>
                                <div style="font-size: 0.9rem; color: var(--neutral-gray);">Accidental Death Benefit</div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="background: rgba(30, 58, 138, 0.05); padding: 20px; border-radius: 10px; margin-top: 20px;">
                        <p style="color: var(--primary-dark); font-weight: 500; font-style: italic;">
                            "This whole life plan provides lifetime protection with enhanced benefits for accidents and support for critical illness diagnoses, ensuring comprehensive coverage for you and stress-free life for your family."
                        </p>
                    </div>
                </div>
            `;
            
            document.getElementById('analysisResults').innerHTML = resultsHTML;
            
            window.currentPremiumData = {
                monthly: monthly,
                sumAssured: sumAssured,
                annualBonus: annualBonus,
                totalPermanentDisability: totalPermanentDisability,
                criticalIllness: criticalIllness,
                naturalDeath: naturalDeath,
                accidentalDeath: accidentalDeath,
                name: userData.analyzerName || 'Customer',
                age: age,
                amount: amount,
                phone: userData.analyzerPhone || 'Not provided',
                email: userData.analyzerEmail || 'Not provided',
                paymentPeriod: userData.analyzerPaymentPeriod || '10'
            };
            
            hasSharedViaWhatsApp = false;
            
            document.getElementById('pdfMessage').style.display = 'block';
            document.getElementById('pdfSuccess').style.display = 'none';
            document.getElementById('pdfDownloadBtnDisabled').style.display = 'flex';
            document.getElementById('pdfDownloadBtn').style.display = 'none';
            
            document.getElementById('prevBtn').style.display = 'flex';
            document.getElementById('nextBtn').style.display = 'none';
            document.getElementById('calculateBtn').style.display = 'none';
        }

        function goBackToCalculator() {
            currentStep = 1;
            updateStepDisplay();
        }

        function sendToWhatsApp(e) {
            e.preventDefault();
            
            const name = userData.analyzerName || 'Customer';
            const age = userData.analyzerAge || 'Not specified';
            const amount = userData.analyzerAmount ? `KES ${parseInt(userData.analyzerAmount).toLocaleString()}` : 'Not specified';
            const phone = userData.analyzerPhone || 'Not provided';
            const email = userData.analyzerEmail || 'Not provided';
            const paymentPeriod = userData.analyzerPaymentPeriod || '10 years';
            
            const ageNum = parseInt(userData.analyzerAge);
            const amountNum = parseInt(userData.analyzerAmount);
            
            let monthlyPremium = 0;
            
            if (premiumData[ageNum] && premiumData[ageNum][amountNum]) {
                monthlyPremium = premiumData[ageNum][amountNum];
            }
            
            const message = `*WHOLE OF LIFE INSURANCE ANALYSIS*

*CUSTOMER DETAILS*
ââââââââââââââââ
*First Name:* ${name}
*Age:* ${age} years
*Phone:* ${phone}
*Email:* ${email}
*Cover Amount:* ${amount}
*Payment Period:* ${paymentPeriod}
*Insurance Type:* Whole of Life Insurance

*HEALTH & LIFESTYLE INFO*
ââââââââââââââââ
*Smoker:* ${userData.analyzerSmoke === 'yes' ? 'Yes' : 'No'}
*Health Status:* ${userData.analyzerHealth || 'Not specified'}

*PREMIUM ANALYSIS*
ââââââââââââââââ
*Monthly Premium:* KES ${monthlyPremium.toLocaleString()}
*Payment Period:* 10 Years

*ADDITIONAL COVERAGE (INCLUSIVE)*
ââââââââââââââââ
â Annual Bonus (2%) on Sum Assured
â Total and Permanent Disability
â Critical Illness Cover
â Accidental Death Benefit

*PREFERRED CONTACT METHOD*
ââââââââââââââââ
${userData.analyzerContactMethod || 'WhatsApp'}

ââââââââââââââââ
*This analysis was generated through the Baba Bima Whole of Life Insurance Premium Analyzer using official rate cards (10-year payment period).*

ð *Call/WhatsApp:* +254 722 460 390
ð§ *Email:* bababimainsurance@gmail.com`;
            
            const encodedMessage = encodeURIComponent(message);
            const whatsappURL = `https://wa.me/254722460390?text=${encodedMessage}`;
            
            window.open(whatsappURL, '_blank');
            
            hasSharedViaWhatsApp = true;
            
            setTimeout(() => {
                document.getElementById('pdfMessage').style.display = 'none';
                document.getElementById('pdfSuccess').style.display = 'block';
                document.getElementById('pdfDownloadBtnDisabled').style.display = 'none';
                document.getElementById('pdfDownloadBtn').style.display = 'flex';
                
                alert('â Analysis shared successfully! You can now download your PDF report.');
            }, 1000);
        }

        function generatePDF() {
            try {
                if (typeof window.jspdf === 'undefined') {
                    alert('PDF library is loading. Please try again in a moment.');
                    return;
                }
                
                if (!hasSharedViaWhatsApp) {
                    document.getElementById('pdfMessage').style.display = 'block';
                    document.getElementById('pdfSuccess').style.display = 'none';
                    return;
                }
                
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                const data = window.currentPremiumData || {
                    monthly: 0,
                    sumAssured: 0,
                    annualBonus: 0,
                    totalPermanentDisability: 0,
                    criticalIllness: 0,
                    naturalDeath: 0,
                    accidentalDeath: 0,
                    name: 'Customer',
                    age: 'Not specified',
                    amount: 0,
                    phone: 'Not provided',
                    email: 'Not provided',
                    paymentPeriod: '10'
                };
                
                doc.setFillColor(30, 58, 138);
                doc.rect(0, 0, 210, 40, 'F');
                doc.setTextColor(255, 255, 255);
                doc.setFontSize(24);
                doc.setFont('helvetica', 'bold');
                doc.text('BABA BIMA INSURANCE', 105, 20, { align: 'center' });
                doc.setFontSize(14);
                doc.text('Whole of Life Insurance Analysis', 105, 30, { align: 'center' });
                
                doc.setTextColor(0, 0, 0);
                doc.setFontSize(16);
                doc.setFont('helvetica', 'bold');
                doc.text('Client Analysis Report', 20, 50);
                
                doc.setDrawColor(30, 58, 138);
                doc.setLineWidth(0.5);
                doc.rect(20, 55, 170, 40);
                
                doc.setFontSize(11);
                doc.setFont('helvetica', 'normal');
                doc.text(`Client: ${data.name}`, 25, 62);
                doc.text(`Age: ${data.age} years`, 25, 68);
                doc.text(`Cover Amount: KES ${data.amount.toLocaleString()}`, 25, 74);
                doc.text(`Phone: ${data.phone}`, 25, 80);
                doc.text(`Email: ${data.email}`, 25, 86);
                
                doc.setFontSize(14);
                doc.setFont('helvetica', 'bold');
                doc.text('Premium Analysis', 20, 105);
                
                doc.setFontSize(12);
                doc.setFont('helvetica', 'normal');
                doc.text(`Monthly Premium: KES ${data.monthly.toLocaleString()}`, 25, 115);
                doc.text(`Payment Period: ${data.paymentPeriod} Years`, 25, 122);
                
                doc.setFontSize(14);
                doc.setFont('helvetica', 'bold');
                doc.text('Coverage Breakdown', 20, 135);
                
                const coverageData = [
                    { benefit: 'Sum Assured (Basic Coverage)', amount: data.sumAssured },
                    { benefit: 'Annual Bonus (2% of Sum Assured)', amount: data.annualBonus },
                    { benefit: 'Total & Permanent Disability', amount: data.totalPermanentDisability },
                    { benefit: 'Critical Illness Benefit (50%)', amount: data.criticalIllness },
                    { benefit: 'Natural Death Benefit', amount: data.naturalDeath },
                    { benefit: 'Accidental Death Benefit (200%)', amount: data.accidentalDeath }
                ];
                
                let yPos = 145;
                coverageData.forEach((item, index) => {
                    doc.setFontSize(10);
                    doc.text(`${index + 1}. ${item.benefit}:`, 25, yPos);
                    doc.text(`KES ${item.amount.toLocaleString()}`, 150, yPos, { align: 'right' });
                    yPos += 7;
                });
                
                doc.setFontSize(9);
                doc.setFont('helvetica', 'italic');
                doc.setTextColor(100, 100, 100);
                doc.text('*Note: Annual bonuses are not included in death benefit calculations as', 25, yPos + 10);
                doc.text('the duration of bonus accumulation cannot be predetermined.', 25, yPos + 15);
                
                doc.setFontSize(9);
                doc.setFont('helvetica', 'italic');
                doc.setTextColor(100, 100, 100);
                doc.text('Data Privacy Notice: Your information is used solely to generate this', 20, yPos + 30);
                doc.text('insurance analysis. We do not store, sell, or share your personal data.', 20, yPos + 35);
                
                doc.setFontSize(9);
                doc.setFont('helvetica', 'normal');
                doc.setTextColor(100, 100, 100);
                doc.text('This analysis was generated by Baba Bima Insurance Premium Analyzer', 105, 280, { align: 'center' });
                doc.text('Contact: +254 722 460 390 | Email: bababimainsurance@gmail.com', 105, 285, { align: 'center' });
                doc.text('Powered by MortApps Studios', 105, 290, { align: 'center' });
                
                const fileName = `BabaBima-Analysis-${data.name.replace(/\s+/g, '-')}-${Date.now()}.pdf`;
                doc.save(fileName);
                
            } catch (error) {
                console.error('PDF Generation Error:', error);
                alert('Error generating PDF. Please try again or use the WhatsApp option.');
            }
        }


        // ========================================================
// === ULTRA-SMART ADVANCED CHATBOT FUNCTIONALITY ===
// ========================================================

const floatingChatbotButton = document.getElementById('floatingChatbotButton');
const chatWidget = document.getElementById('aiChatWidget');
const closeChat = document.getElementById('closeChat');
let chatInput = document.getElementById('chatInput');
const chatMessages = document.getElementById('chatMessages');
const typingIndicator = document.getElementById('typingIndicator');

// Chat state tracking
let isChatOpen = false;
let lastUserQuestion = '';
let conversationContext = {
    userInterests: [],
    timeOfDay: '',
    hasBeenGreeted: false,
    userName: null,
    lastTopic: null,
    conversationMood: 'neutral',
    messageCount: 0,
    mortappsMentioned: false,
    isNewClient: true
};

// LocalStorage key for chat history
const CHAT_STORAGE_KEY = 'bababima_chat_history_v4';

// Load chat history from localStorage
function loadChatHistory() {
    try {
        const savedHistory = localStorage.getItem(CHAT_STORAGE_KEY);
        if (savedHistory) {
            const history = JSON.parse(savedHistory);
            const firstMessage = chatMessages.querySelector('.first-message');
            chatMessages.innerHTML = '';
            if (firstMessage) chatMessages.appendChild(firstMessage);
            
            history.forEach(msg => {
                const messageDiv = document.createElement('div');
                messageDiv.className = msg.type === 'user' ? 'user-message' : 'bot-message';
                messageDiv.style.cssText = msg.type === 'user' 
                    ? 'background:linear-gradient(135deg,var(--primary-blue),var(--primary-dark));color:white;padding:12px 16px;border-radius:12px 12px 4px 12px;margin:12px 0 15px auto;max-width:85%;word-wrap:break-word;align-self:flex-end;box-shadow:0 3px 10px rgba(30,58,138,0.2)'
                    : 'background:#f1f5f9;padding:12px 16px;border-radius:12px 12px 12px 4px;margin-bottom:15px;max-width:85%;word-wrap:break-word;align-self:flex-start;box-shadow:0 3px 10px rgba(0,0,0,0.05);border-left:3px solid var(--accent-gold)';
                messageDiv.innerHTML = msg.content;
                chatMessages.appendChild(messageDiv);
            });
            chatMessages.scrollTop = chatMessages.scrollHeight;
            conversationContext.isNewClient = false;
        }
    } catch (error) {
        console.log('No chat history to load');
    }
}

// Save message to localStorage
function saveChatMessage(type, content) {
    try {
        let history = [];
        const saved = localStorage.getItem(CHAT_STORAGE_KEY);
        if (saved) {
            history = JSON.parse(saved);
        }
        history.push({ type, content, timestamp: Date.now() });
        if (history.length > 100) {
            history = history.slice(-100);
        }
        localStorage.setItem(CHAT_STORAGE_KEY, JSON.stringify(history));
    } catch (error) {
        console.log('Could not save chat history');
    }
}

// Clear chat history
function clearChatHistory() {
    if (confirm('Are you sure you want to clear your chat history? This action cannot be undone.')) {
        try {
            localStorage.removeItem(CHAT_STORAGE_KEY);
            
            const firstMessage = chatMessages.querySelector('.first-message');
            chatMessages.innerHTML = '';
            if (firstMessage) {
                chatMessages.appendChild(firstMessage);
            } else {
                const greeting = getAutoGreeting();
                const welcomeDiv = document.createElement('div');
                welcomeDiv.className = 'first-message';
                welcomeDiv.innerHTML = `<strong>Milton AI:</strong> ${greeting} I'm your intelligent insurance assistant created by MortApps Studios. I can answer detailed questions about Baba Bima's Whole Life Insurance, premiums, coverage, and more. What would you like to know?`;
                chatMessages.appendChild(welcomeDiv);
            }
            
            conversationContext = {
                userInterests: [],
                timeOfDay: getTimeOfDay(),
                hasBeenGreeted: false,
                userName: null,
                lastTopic: null,
                conversationMood: 'neutral',
                messageCount: 0,
                mortappsMentioned: false,
                isNewClient: true
            };
            
            const confirmDiv = document.createElement('div');
            confirmDiv.style.cssText = 'background:#10B981;color:white;padding:10px;border-radius:8px;margin:10px 0;text-align:center;font-size:13px;animation:fadeIn 0.3s';
            confirmDiv.innerHTML = '<i class="fas fa-check-circle"></i> Chat history cleared successfully!';
            chatMessages.appendChild(confirmDiv);
            
            setTimeout(() => {
                confirmDiv.remove();
            }, 3000);
            
            chatMessages.scrollTop = chatMessages.scrollHeight;
        } catch (error) {
            alert('Error clearing chat history. Please try again.');
        }
    }
}

function getTimeOfDay() {
    const hour = new Date().getHours();
    if (hour < 12) return 'morning';
    if (hour < 17) return 'afternoon';
    if (hour < 21) return 'evening';
    return 'night';
}

conversationContext.timeOfDay = getTimeOfDay();

const chatbotPersonality = {
    name: "Milton AI",
    role: "Insurance Assistant",
    creator: "MortApps Studios",
    mood: "helpful",
    style: "professional but friendly",
    responseStyle: "detailed but clear"
};

// ENHANCED FORMAT RESPONSE FUNCTION - CLEANER VERSION
function formatResponse(text) {
    let formatted = text;
    
    // First, safely handle any raw CSS that might appear (just in case)
    formatted = formatted.replace(/0\.\s*\d+\);?/g, '');
    formatted = formatted.replace(/rgba\([^)]+\);/g, '');
    formatted = formatted.replace(/font-size:\s*\d+px/g, '');
    
    // Handle headings
    formatted = formatted.replace(/##\s*(.+?)(?:\n|$)/g, '<div class="chat-heading">$1</div>');
    
    // Handle subheadings
    formatted = formatted.replace(/\*\*(.+?)\*\*/g, '<div class="chat-subheading">$1</div>');
    
    // Handle bullet points
    formatted = formatted.replace(/â¢\s*(.+?)(?:\n|$)/g, '<div style="padding-left:20px;margin:5px 0"><i class="fas fa-check-circle" style="color:var(--accent-green);margin-right:8px"></i>$1</div>');
    formatted = formatted.replace(/â\s*(.+?)(?:\n|$)/g, '<div style="padding-left:20px;margin:5px 0"><i class="fas fa-check" style="color:var(--accent-green);margin-right:8px"></i>$1</div>');
    
    // Handle numbered lists
    formatted = formatted.replace(/(\d+)\.\s*(.+?)(?:\n|$)/g, '<div style="padding-left:20px;margin:5px 0"><strong style="color:var(--primary-blue)">$1.</strong> $2</div>');
    
    // Handle emojis and icons
    formatted = formatted.replace(/ð¹/g, '<i class="fas fa-square" style="color:var(--primary-blue);font-size:10px;margin:0 8px"></i>');
    formatted = formatted.replace(/ð/g, '<i class="fas fa-chart-bar" style="color:var(--primary-blue);margin-right:5px"></i>');
    formatted = formatted.replace(/ð¡ï¸/g, '<i class="fas fa-shield-alt" style="color:var(--primary-blue);margin-right:5px"></i>');
    formatted = formatted.replace(/ð¯/g, '<i class="fas fa-bullseye" style="color:var(--accent-gold);margin-right:5px"></i>');
    formatted = formatted.replace(/ð°/g, '<i class="fas fa-coins" style="color:var(--accent-gold);margin-right:5px"></i>');
    formatted = formatted.replace(/ð/g, '<i class="fas fa-phone" style="color:var(--accent-green);margin-right:5px"></i>');
    formatted = formatted.replace(/ð¬/g, '<i class="fab fa-whatsapp" style="color:var(--accent-green);margin-right:5px"></i>');
    formatted = formatted.replace(/ð§/g, '<i class="fas fa-envelope" style="color:var(--primary-blue);margin-right:5px"></i>');
    formatted = formatted.replace(/ð¨âð¼/g, '<i class="fas fa-user-tie" style="color:var(--primary-blue);margin-right:5px"></i>');
    formatted = formatted.replace(/ð/g, '<i class="fas fa-globe" style="color:var(--accent-green);margin-right:5px"></i>');
    formatted = formatted.replace(/â°/g, '<i class="fas fa-clock" style="color:var(--neutral-gray);margin-right:5px"></i>');
    formatted = formatted.replace(/ð/g, '<i class="fas fa-clipboard-list" style="color:var(--primary-blue);margin-right:5px"></i>');
    formatted = formatted.replace(/ð¥/g, '<i class="fas fa-hospital" style="color:var(--accent-red);margin-right:5px"></i>');
    formatted = formatted.replace(/ð¡/g, '<i class="fas fa-lightbulb" style="color:var(--accent-gold);margin-right:5px"></i>');
    formatted = formatted.replace(/ð/g, '<i class="fas fa-rocket" style="color:var(--primary-blue);margin-right:5px"></i>');
    formatted = formatted.replace(/ð»/g, '<i class="fas fa-laptop-code" style="color:var(--primary-blue);margin-right:5px"></i>');
    formatted = formatted.replace(/ð/g, '<i class="fas fa-trophy" style="color:var(--accent-gold);margin-right:5px"></i>');
    formatted = formatted.replace(/ð¤/g, '<i class="fas fa-handshake" style="color:var(--accent-green);margin-right:5px"></i>');
    
    // Handle line breaks
    formatted = formatted.replace(/\n\n/g, '<br><br>');
    formatted = formatted.replace(/\n/g, '<br>');
    
    return formatted;
}

// ENHANCED FUNCTION TO GET SUBTLE MORTAPPS MENTION - WITH THEIR AWESOME BRANDING
function getSubtleMortappsMention() {
    const mentions = [
        `<br><div style="margin-top:15px;padding-top:10px;border-top:1px dashed rgba(30,58,138,0.2);font-size:12px;color:var(--neutral-gray);"><i>ð» Professional website by <a href="https://mortappsstudios.com" target="_blank" style="color:var(--primary-blue);text-decoration:none;font-weight:500;">MortApps Studios</a> - Kenya's premium web development company</i></div>`,
        `<br><div style="margin-top:15px;padding-top:10px;border-top:1px dashed rgba(30,58,138,0.2);font-size:12px;color:var(--neutral-gray);"><i>ð Digital excellence powered by <a href="https://mortappsstudios.com" target="_blank" style="color:var(--primary-blue);text-decoration:none;font-weight:500;">MortApps Studios</a></i></div>`,
        `<br><div style="margin-top:15px;padding-top:10px;border-top:1px dashed rgba(30,58,138,0.2);font-size:12px;color:var(--neutral-gray);"><i>ð Website crafted with excellence by <a href="https://mortappsstudios.com" target="_blank" style="color:var(--primary-blue);text-decoration:none;font-weight:500;">MortApps Studios</a></i></div>`,
        `<br><div style="margin-top:15px;padding-top:10px;border-top:1px dashed rgba(30,58,138,0.2);font-size:12px;color:var(--neutral-gray);"><i>ð¤ Digital partnership with <a href="https://mortappsstudios.com" target="_blank" style="color:var(--primary-blue);text-decoration:none;font-weight:500;">MortApps Studios</a> - Premium web solutions</i></div>`,
        `<br><div style="margin-top:15px;padding-top:10px;border-top:1px dashed rgba(30,58,138,0.2);font-size:12px;color:var(--neutral-gray);"><i>ð¡ Smart digital solution by <a href="https://mortappsstudios.com" target="_blank" style="color:var(--primary-blue);text-decoration:none;font-weight:500;">MortApps Studios</a></i></div>`,
        `<br><div style="margin-top:15px;padding-top:10px;border-top:1px dashed rgba(30,58,138,0.2);font-size:12px;color:var(--neutral-gray);"><i>ð¯ Cutting-edge web development by <a href="https://mortappsstudios.com" target="_blank" style="color:var(--primary-blue);text-decoration:none;font-weight:500;">MortApps Studios</a></i></div>`
    ];
    
    // Mention MortApps in about 20% of responses (subtle marketing)
    if (Math.random() > 0.8) {
        return mentions[Math.floor(Math.random() * mentions.length)];
    }
    return '';
}

// ============= KEEPING ALL ORIGINAL KNOWLEDGE =============
// (This is the comprehensive knowledge base from your original working chatbot)

const comprehensiveKnowledgeBase = {
    // MORTAPPS STUDIOS INFORMATION (KEEPING OUR VERSION - MORE DETAILED)
    "mortapps": `## About MortApps Studios

<div class="chat-section">
ð <strong>Kenya's Premium Web Development Company</strong>

MortApps Studios is the creative force behind this Baba Bima Insurance website and many other successful Kenyan business websites.
</div>

<div class="chat-section">
ð <strong>What They Do:</strong>
â¢ Custom website design & development
â¢ Web applications & digital solutions
â¢ E-commerce platforms
â¢ Business automation tools
â¢ Mobile-responsive designs
â¢ SEO optimization
</div>

<div class="chat-section">
ð¡ <strong>Their Approach:</strong>
â¢ Client-focused solutions
â¢ Modern, clean designs
â¢ User-friendly interfaces
â¢ Fast loading speeds
â¢ Secure, reliable hosting
â¢ Ongoing support & maintenance
</div>

<div class="chat-section">
ð¯ <strong>Why Businesses Choose MortApps:</strong>
1. <strong>Professional Quality</strong> - Enterprise-level solutions
2. <strong>Local Understanding</strong> - Kenyan market expertise
3. <strong>Affordable Excellence</strong> - Premium quality at fair prices
4. <strong>Proven Results</strong> - Portfolio of successful projects
5. <strong>Full Service</strong> - From concept to launch and beyond
</div>

<div class="chat-section">
ð <strong>Contact MortApps Studios:</strong>
â¢ Website: https://mortappsstudios.com
â¢ Portfolio: https://mortappsstudios.com/portfolio
â¢ Email: info@mortappsstudios.com
â¢ Services: Custom websites, web apps, digital solutions
</div>

<div class="chat-subheading">Note:</strong>
This intelligent chatbot and the entire Baba Bima website experience were designed and developed by MortApps Studios, showcasing their commitment to creating powerful digital tools for Kenyan businesses.`,

    // GET STARTED / BEGINNER QUESTIONS (ORIGINAL)
    "get started": `## How to Get Started with Baba Bima Insurance

<div class="chat-subheading">Step-by-Step Process:</div>

ð <strong>1. Initial Assessment</strong>
â¢ Use our Premium Analyzer tool to calculate your exact premium
â¢ Determine your ideal coverage amount based on needs
â¢ Get instant quote based on age and desired coverage

ð¬ <strong>2. Initial Consultation</strong>
â¢ Contact us via WhatsApp: +254 722 460 390
â¢ Speak directly with Milton Muriithi (35+ years experience)
â¢ Discuss your specific needs and financial goals

ð <strong>3. Application Process</strong>
â¢ Complete simple application form
â¢ Provide basic personal information
â¢ No lengthy paperwork required

ð¨âð¼ <strong>4. Professional Guidance</strong>
â¢ Milton will guide you through policy selection
â¢ Explain all terms and conditions clearly
â¢ Help you choose the right payment plan

â <strong>5. Policy Issuance</strong>
â¢ Receive your policy documents
â¢ Start enjoying protection immediately
â¢ Regular follow-ups to ensure satisfaction

<div class="chat-subheading">What You Need:</div>
â¢ Basic personal information
â¢ Kenyan phone number
â¢ Email address
â¢ No medical exams for most policies under KES 15M

<div class="chat-subheading">Ready to Begin?</div>
Start with our Premium Analyzer or WhatsApp us directly at +254 722 460 390`,

    // BENEFITS OF LIFE INSURANCE (ORIGINAL)
    "benefits of life insurance": `## Comprehensive Benefits of Whole Life Insurance

<div class="chat-section">
<strong>Financial Security Benefits:</strong>
ð° <strong>1. Lifetime Protection</strong>
â¢ Coverage never expires (as long as premiums paid)
â¢ Protection for your entire lifetime
â¢ Peace of mind for you and family

ð¡ï¸ <strong>2. Financial Safety Net</strong>
â¢ Tax-free death benefit to beneficiaries
â¢ Income replacement for family
â¢ Debt coverage (mortgage, loans)
â¢ Education funds for children

ð¯ <strong>3. Wealth Accumulation</strong>
â¢ Cash value grows tax-deferred
â¢ Annual bonuses (2% of sum assured)
â¢ Can borrow against policy value
â¢ Collateral for business loans

ð¡ <strong>4. Estate Planning</strong>
â¢ Avoids probate delays
â¢ Preserves family wealth
â¢ Business succession planning
â¢ Charitable giving tool
</div>

<div class="chat-section">
<strong>Enhanced Health Benefits (Included):</strong>
ð¥ <strong>Critical Illness Cover</strong>
â¢ 50% of sum assured (max KES 15M)
â¢ 40+ covered conditions
â¢ Lump sum payout on diagnosis
â¢ Premium waiver after claim

ð¡ï¸ <strong>Accident Protection</strong>
â¢ 200% accidental death benefit
â¢ Total permanent disability cover
â¢ Coverage until age 65
â¢ No additional cost
</div>

<div class="chat-section">
<strong>Tax Advantages:</strong>
â¢ Up to 15% insurance tax relief
â¢ Tax-free death benefits
â¢ Tax-deferred cash growth
â¢ Lower taxable estate
</div>

<div class="chat-subheading">Why Choose Whole Life Over Term?</strong>
â¢ Permanent coverage vs temporary
â¢ Cash value accumulation
â¢ Fixed premiums that never increase
â¢ Additional living benefits`,

    // PREMIUM & PRICING DETAILS (ORIGINAL)
    "premium": `## Premium Details & Payment Options

<div class="chat-subheading">Premium Calculation Factors:</div>

1. <strong>Age</strong> - Younger age = Lower premium
2. <strong>Cover Amount</strong> - Higher coverage = Higher premium
3. <strong>Payment Period</strong> - Longer period = Lower monthly payment

<div class="chat-subheading">Sample Premiums (KES 5M Coverage, 10-year payment):</div>
â¢ Age 25: KES 6,188/month
â¢ Age 30: KES 6,648/month  
â¢ Age 35: KES 7,768/month
â¢ Age 40: KES 9,839/month
â¢ Age 45: KES 13,018/month
â¢ Age 50: KES 18,030/month
â¢ Age 55: KES 25,464/month
â¢ Age 60: KES 44,234/month

<div class="chat-subheading">Payment Period Options:</div>
â <strong>10 Years</strong> - Most popular, higher monthly but shorter commitment
â <strong>15 Years</strong> - Balanced option
â <strong>20 Years</strong> - Lower monthly payments
â <strong>Up to Age 60/65</strong> - Spread payments longer
â <strong>Entire Lifetime</strong> - Smallest monthly payments

<div class="chat-subheading">Coverage Options Available:</div>
KES 2M, 3M, 4M, 5M, 6M, 7M, 8M, 9M, 10M (and higher amounts available)

<strong>Want your exact premium?</strong> Use our Premium Analyzer tool!`,

    // COVERAGE DETAILS (ORIGINAL)
    "what is covered": `## Comprehensive Coverage Details

<div class="chat-section">
<strong>1. BASIC SUM ASSURED</strong>
â¢ Lifetime death benefit
â¢ Never reduces or expires
â¢ Paid to beneficiaries tax-free
â¢ Amount chosen by you (KES 1M - 150M)
</div>

<div class="chat-section">
<strong>2. CRITICAL ILLNESS BENEFIT (50% of Sum Assured)</strong>
<strong>Covered Conditions Include:</strong>
â¢ Cancer (all types)
â¢ Heart attack
â¢ Stroke
â¢ Kidney failure
â¢ Major organ transplant
â¢ Paralysis
â¢ Blindness
â¢ Deafness
â¢ Coma
â¢ Alzheimer's disease
â¢ Parkinson's disease
â¢ Multiple sclerosis
â¢ And 30+ more conditions

<strong>Key Features:</strong>
â¢ Lump sum payment on first diagnosis
â¢ Maximum KES 15,000,000
â¢ Premiums waived after claim
â¢ Policy continues for other benefits
</div>

<div class="chat-section">
<strong>3. ACCIDENTAL DEATH BENEFIT (200% of Sum Assured)</strong>
â¢ Doubles protection for accidental deaths
â¢ Covers all accident types
â¢ Worldwide coverage
â¢ Paid in addition to basic sum
</div>

<div class="chat-section">
<strong>4. TOTAL & PERMANENT DISABILITY (100% of Sum Assured)</strong>
â¢ For severe accidents causing disability
â¢ Coverage until age 65
â¢ Includes loss of limbs, sight, etc.
â¢ Helps replace lost income
</div>

<div class="chat-section">
<strong>5. ANNUAL BONUSES (2% of Sum Assured)</strong>
â¢ Added to policy value yearly
â¢ Compounded growth
â¢ Increases death benefit over time
â¢ Can be withdrawn or borrowed against
</div>

<div class="chat-subheading">What's NOT Covered (Standard Exclusions):</div>
â¢ Suicide within first 1-2 years
â¢ Death from illegal activities
â¢ Pre-existing conditions (unless disclosed)
â¢ War or nuclear hazards`,

    // CLAIMS PROCESS (ORIGINAL)
    "claim": `## Simple Claims Process

<div class="chat-subheading">Step-by-Step Claims Procedure:</div>

ð <strong>1. Immediate Notification</strong>
â¢ Contact us immediately: +254 722 460 390
â¢ We guide you through next steps
â¢ 24/7 support available

ð <strong>2. Documentation</strong>
â¢ Death certificate (for death claims)
â¢ Medical reports (for critical illness)
â¢ Police report (for accidents)
â¢ Completed claim forms

ð¨âð¼ <strong>3. Our Assistance</strong>
â¢ We help complete all paperwork
â¢ Submit claims on your behalf
â¢ Follow up with insurance company
â¢ Handle all communications

ð° <strong>4. Fast Processing</strong>
â¢ Typical processing: 7-14 days
â¢ Critical illness: 3-7 days after documents
â¢ We expedite urgent cases
â¢ Regular updates provided

â <strong>5. Payment</strong>
â¢ Direct bank transfer to beneficiary
â¢ Full amount paid (no deductions)
â¢ Tax-free payment
â¢ We ensure timely receipt

<div class="chat-subheading">Documents Typically Required:</div>
â¢ Original policy document
â¢ Death certificate (certified copy)
â¢ Claimant's ID/passport
â¢ Burial permit
â¢ Medical reports (if applicable)
â¢ Police abstract (accident cases)

<div class="chat-subheading">Our Claims Support:</div>
â¢ Personal assistance throughout
â¢ No extra fees for claims service
â¢ We fight for your rightful claim
â¢ 35+ years claims experience`,

    // ABOUT BABA BIMA (ORIGINAL)
    "about baba bima": `## About Baba Bima Insurance

<div class="chat-section">
ð¨âð¼ <strong>Founder & Team Leader: Milton Muriithi</strong>
â¢ 35+ years insurance experience
â¢ Financial planning expert
â¢ Trusted advisor to thousands
â¢ Passionate about simplifying insurance
</div>

<div class="chat-section">
ð <strong>Our Mission</strong>
To make insurance simple, accessible, and meaningful for everyday people through:
â¢ Clear explanations
â¢ Fair pricing
â¢ Personal service
â¢ Modern technology
</div>

<div class="chat-section">
ð¡ï¸ <strong>Our Companies</strong>
â¢ <strong>Baba Bima Insurance</strong> - Main insurance services
â¢ <strong>Diaspora Family Services</strong> - International coverage
â¢ <strong>Diaspora Insurance Intermediaries</strong> - Specialized expat services
â¢ <strong>Golden Sunset Welfare</strong> - Retirement planning
</div>

<div class="chat-section">
ð¯ <strong>Why Choose Us?</strong>
1. <strong>Experience</strong> - 35+ years in the industry
2. <strong>Personal Touch</strong> - Direct access to Milton
3. <strong>Global Backing</strong> - Multinational insurer (40+ countries)
4. <strong>Technology</strong> - Modern tools like this chatbot
5. <strong>Integrity</strong> - Honest, transparent advice
</div>

<div class="chat-section">
ð <strong>Contact Information</strong>
â¢ Phone/WhatsApp: +254 722 460 390
â¢ Email: bababimainsurance@gmail.com
â¢ Website: https://miltonmuriithi.com
â¢ Service: 24/7 availability
</div>

<strong>Our Promise:</strong> We treat every client like family and provide advice we'd give our own relatives.`,

    // CRITICAL ILLNESS SPECIFICS (ORIGINAL)
    "critical illness": `## Critical Illness Cover - Complete Details

<div class="chat-section">
ð¥ <strong>What is Critical Illness Cover?</strong>
A lump sum payment if diagnosed with any of 40+ serious medical conditions. This is INCLUDED in our Whole Life policies at no extra cost.
</div>

<div class="chat-section">
ð° <strong>Coverage Amount:</strong>
â¢ 50% of your sum assured
â¢ Maximum: KES 15,000,000
â¢ Example: KES 5M policy = KES 2.5M critical illness benefit
</div>

<div class="chat-section">
ð <strong>Major Conditions Covered:</strong>

<strong>Cancer (All Types)</strong>
â¢ Any malignant tumor
â¢ Requires histological confirmation
â¢ Excluding early-stage cancers

<strong>Heart Conditions</strong>
â¢ Heart attack (myocardial infarction)
â¢ Coronary artery bypass surgery
â¢ Heart valve replacement
â¢ Cardiomyopathy

<strong>Neurological Conditions</strong>
â¢ Stroke (cerebral vascular accident)
â¢ Multiple sclerosis
â¢ Parkinson's disease
â¢ Alzheimer's disease
â¢ Motor neuron disease
â¢ Coma (48+ hours)

<strong>Organ Conditions</strong>
â¢ Kidney failure (dialysis)
â¢ Major organ transplant
â¢ Liver failure
â¢ Lung disease

<strong>Other Serious Conditions</strong>
â¢ Paralysis (limb loss)
â¢ Blindness (permanent)
â¢ Deafness (permanent)
â¢ Severe burns (3rd degree)
â¢ Loss of speech
â¢ Benign brain tumor
</div>

<div class="chat-section">
â <strong>Claim Process:</strong>
1. Diagnosis by specialist doctor
2. Medical reports submitted
3. We handle all paperwork
4. Payment within days
5. Future premiums WAIVED
6. Policy continues for other benefits
</div>

<div class="chat-subheading">Why This Coverage is Essential:</div>
â¢ Medical bills can bankrupt families
â¢ Income stops during treatment
â¢ Additional care costs arise
â¢ Peace of mind during recovery`,

    // TAX BENEFITS (ORIGINAL)
    "tax": `## Insurance Tax Benefits in Kenya

<div class="chat-section">
ð° <strong>Insurance Relief (Section 55 of Income Tax Act)</strong>
â¢ <strong>Up to 15% of premium</strong> tax deductible
â¢ <strong>Maximum KES 60,000</strong> per year
â¢ <strong>Applies to</strong> life insurance premiums
â¢ <strong>Reduces</strong> your taxable income
</div>

<div class="chat-section">
ð <strong>Example Calculation:</strong>
If you pay KES 100,000 annual premium:
â¢ Tax relief: 15% of KES 100,000 = KES 15,000
â¢ Your taxable income reduces by KES 15,000
â¢ Actual tax savings depends on your tax bracket
â¢ Higher earners save more
</div>

<div class="chat-section">
ð¯ <strong>Additional Tax Advantages:</strong>

<strong>1. Tax-Free Death Benefits</strong>
â¢ Entire sum assured paid tax-free to beneficiaries
â¢ No inheritance tax in Kenya
â¢ Avoids probate delays

<strong>2. Tax-Deferred Cash Growth</strong>
â¢ Annual bonuses grow tax-deferred
â¢ No annual tax on accumulated value
â¢ Tax only on withdrawal (if any)

<strong>3. Estate Tax Planning</strong>
â¢ Reduces taxable estate
â¢ Provides liquidity for estate taxes
â¢ Avoids forced asset sales
</div>

<div class="chat-section">
ð <strong>How to Claim Tax Relief:</strong>
1. Keep your premium payment receipts
2. Provide to your employer/accountant
3. Claim through annual tax return
4. We provide necessary documentation
</div>

<div class="chat-subheading">Smart Financial Planning:</div>
Insurance is one of the few ways to get tax relief while building wealth and protection simultaneously. It's essentially getting government subsidy for protecting your family!`,

    // DIASPORA SERVICES (ORIGINAL)
    "diaspora": `## Diaspora Insurance Services

<div class="chat-section">
ð <strong>Specialized for Kenyans Abroad</strong>
We understand the unique needs of diaspora community:
â¢ Working abroad (UK, USA, Canada, Middle East, etc.)
â¢ Planning to return home
â¢ Supporting family in Kenya
â¢ Building retirement nest egg
</div>

<div class="chat-section">
ð¯ <strong>Why Diaspora Need Insurance:</strong>
1. <strong>Family Protection</strong> - Secure those back home
2. <strong>Retirement Planning</strong> - Build Kenya-based assets
3. <strong>Currency Advantage</strong> - Foreign income buys more coverage
4. <strong>Tax Efficiency</strong> - Optimize cross-border taxation
5. <strong>Repatriation</strong> - Plan for eventual return
</div>

<div class="chat-section">
ð° <strong>Diaspora-Specific Advantages:</strong>
â¢ <strong>Higher Coverage</strong> - Up to KES 150,000,000
â¢ <strong>Premium Payments</strong> - In foreign currency or M-Pesa
â¢ <strong>Communication</strong> - WhatsApp, email, video calls
â¢ <strong>Documentation</strong> - Electronic processing
â¢ <strong>Claims</strong> - International coordination
</div>

<div class="chat-section">
ð <strong>How We Serve Diaspora:</strong>
1. <strong>Virtual Consultations</strong> - Any time zone
2. <strong>Digital Documentation</strong> - No physical paperwork
3. <strong>International Payments</strong> - Multiple currency options
4. <strong>Family Coordination</strong> - Support for relatives in Kenya
5. <strong>Return Planning</strong> - Smooth transition advice
</div>

<div class="chat-subheading">Contact for Diaspora Services:</div>
â¢ WhatsApp: +254 722 460 390 (Works worldwide)
â¢ Email: bababimainsurance@gmail.com
â¢ Website: https://miltonmuriithi.com
â¢ Special: Ask for "Diaspora Package"`,

    // RETIREMENT PLANNING (ORIGINAL)
    "retirement": `## Retirement Planning with Whole Life Insurance

<div class="chat-section">
ð¯ <strong>Double Benefit Strategy:</strong>
Whole Life Insurance serves two purposes:
1. <strong>Protection</strong> - Family security during working years
2. <strong>Retirement Fund</strong> - Cash value accumulation for retirement
</div>

<div class="chat-section">
ð° <strong>How It Works for Retirement:</strong>

<strong>Cash Value Accumulation</strong>
â¢ Premiums build cash value over time
â¢ Annual bonuses (2%) accelerate growth
â¢ Tax-deferred compounding
â¢ Can access after 10+ years

<strong>Retirement Options:</strong>
1. <strong>Policy Loan</strong> - Borrow against cash value (tax-free)
2. <strong>Partial Withdrawal</strong> - Take some cash, keep coverage
3. <strong>Paid-up Policy</strong> - Stop payments, reduced coverage continues
4. <strong>Annuity Conversion</strong> - Convert to monthly retirement income
</div>

<div class="chat-section">
ð <strong>Example: Starting at Age 35</strong>
â¢ Policy: KES 5,000,000 Whole Life
â¢ Premium: ~KES 7,768/month (10-year payment)
â¢ By Age 65 (30 years later):
  - Cash value: ~KES 3,000,000+
  - Death benefit: ~KES 8,000,000+ (with bonuses)
  - Can borrow/withdraw for retirement
  - Family still protected
</div>

<div class="chat-section">
ð <strong>Advantages Over Other Retirement Plans:</strong>
â¢ <strong>Guaranteed</strong> - Not market-dependent
â¢ <strong>Protected</strong> - Creditors can't access
â¢ <strong>Flexible</strong> - Multiple access options
â¢ <strong>Tax-Efficient</strong> - Favorable tax treatment
â¢ <strong>Dual Purpose</strong> - Protection + savings
</div>

<div class="chat-subheading">Golden Sunset Welfare:</strong>
Our specialized retirement planning division helps create comprehensive retirement strategies incorporating insurance, investments, and estate planning.`,

    // BUSINESS INSURANCE (ORIGINAL)
    "business": `## Business Insurance Solutions

<div class="chat-section">
ð¢ <strong>Key Person Insurance</strong>
â¢ Protect against loss of key employees
â¢ Coverage amounts: KES 5M - 150M
â¢ Helps business survive key person loss
â¢ Funds recruitment/training of replacement
</div>

<div class="chat-section">
ð¤ <strong>Partnership Insurance</strong>
â¢ Buy-sell agreement funding
â¢ Ensures smooth ownership transition
â¢ Prevents business dissolution
â¢ Fair valuation established
</div>

<div class="chat-section">
ð° <strong>Loan Protection</strong>
â¢ Covers business loans
â¢ Ensures loans repaid if something happens
â¢ Protects business assets
â¢ Required by many lenders
</div>

<div class="chat-section">
ð¥ <strong>Group Insurance for Employees</strong>
â¢ Attract and retain talent
â¢ Tax-deductible for business
â¢ Bulk discounts available
â¢ Customizable packages
</div>

<div class="chat-section">
ð¯ <strong>Business Continuation Planning</strong>
â¢ Succession planning with insurance
â¢ Estate duty planning
â¢ Shareholder protection
â¢ Executive bonus plans
</div>

<div class="chat-subheading">Our Business Approach:</div>
1. <strong>Business Analysis</strong> - Understand your unique needs
2. <strong>Risk Assessment</strong> - Identify key vulnerabilities
3. <strong>Custom Solution</strong> - Tailored insurance strategy
4. <strong>Implementation</strong> - Smooth setup process
5. <strong>Ongoing Review</strong> - Regular policy reviews

<div class="chat-subheading">Contact for Business Insurance:</div>
â¢ WhatsApp: +254 722 460 390
â¢ Ask for "Business Insurance Consultation"
â¢ Free initial business assessment`,

    // GENERAL GREETINGS AND RESPONSES (ORIGINAL + ENHANCED)
    "greetings": {
        "morning": `Good morning! âï¸ A wonderful day to you! I'm Milton AI, your intelligent insurance assistant created by MortApps Studios. How may I help you secure your future today?`,
        "afternoon": `Good afternoon! ð¤ï¸ Hope you're having a productive day. I'm Milton AI, powered by MortApps Studios's advanced technology. What insurance questions can I answer for you?`,
        "evening": `Good evening! ð A peaceful evening to you. I'm Milton AI, here to assist with all your insurance needs. How can I help you this evening?`,
        "night": `Good night! ð Perfect time to plan for tomorrow's security. I'm Milton AI. If you have insurance questions, I'm here to help!`,
        "general": `Hello! ð I'm Milton AI, your intelligent insurance assistant created by MortApps Studios. I know everything about Baba Bima's insurance solutions. How may I assist you?`,
        "returning": `Welcome back! ð Good to see you again. What would you like to know today about insurance?`
    }
};

// ============== ADDITIONAL KNOWLEDGE FROM OUR VERSION ==============
const additionalKnowledgeBase = {
    // PREMIUM ANALYZER GUIDANCE (ENHANCED RESPONSE)
    "premium analyzer guide": `## ð Get Accurate Premium Estimates with Our Premium Analyzer

<div class="chat-section">
ð¯ <strong>For the Most Accurate & Personalized Quote:</strong>
I'd recommend using our <strong>Premium Analyzer tool</strong> right here on this page! It's specifically designed to give you exact premium calculations based on:
</div>

<div class="chat-section">
ð <strong>What the Premium Analyzer Considers:</strong>
1. <strong>Your Exact Age</strong> - Premiums change with every year
2. <strong>Desired Coverage Amount</strong> - From KES 2M to 10M+
3. <strong>Payment Period</strong> - Standard 10-year payment option
4. <strong>Your Health Profile</strong> - For better understanding
5. <strong>Contact Information</strong> - For follow-up consultation
</div>

<div class="chat-section">
ð <strong>Why Use the Premium Analyzer?</strong>
â¢ <strong>Real Calculations</strong> - Based on official insurance rate cards
â¢ <strong>Instant Results</strong> - Get your monthly premium in seconds
â¢ <strong>Complete Breakdown</strong> - See all benefits included
â¢ <strong>PDF Report</strong> - Download your analysis for reference
â¢ <strong>Direct WhatsApp Sharing</strong> - Send to Baba Bima for follow-up
</div>

<div class="chat-section">
ð <strong>How to Access It:</strong>
1. Scroll to the <strong>"Premium Analyzer"</strong> section on this page
2. Click on it or use the navigation menu
3. Follow the 3 simple steps
4. Get your personalized premium calculation

<strong>Pro Tip:</strong> The analyzer uses exact age-based calculations, so you'll get much more accurate results than general estimates!
</div>

<div class="chat-section">
ð¡ <strong>Need Help with the Analyzer?</strong>
If you have questions while using it, just ask me! I can guide you through each step.
</div>`,

    // COVERAGE LIMITS AND OPTIONS
    "coverage limits": `## ð Whole Life Insurance Coverage Limits & Options

<div class="chat-section">
ð° <strong>Available Coverage Amounts:</strong>
â¢ <strong>Standard Range:</strong> KES 2,000,000 to KES 10,000,000
â¢ <strong>Extended Range:</strong> Up to KES 150,000,000 (for special cases)
â¢ <strong>Most Popular:</strong> KES 5,000,000 (Balanced protection & affordability)
</div>

<div class="chat-section">
ð¯ <strong>How Much Coverage Should You Get?</strong>
This depends on several factors:
1. <strong>Income Replacement</strong> - 5-10 times your annual income
2. <strong>Debts & Mortgage</strong> - Cover all outstanding loans
3. <strong>Education Costs</strong> - Children's future education
4. <strong>Final Expenses</strong> - Burial, medical bills, etc.
5. <strong>Future Inflation</strong> - Account for rising costs
</div>

<div class="chat-section">
ð <strong>Sample Coverage Scenarios:</strong>

<strong>For Young Professionals (25-35 years):</strong>
â¢ Coverage: KES 3M - 5M
â¢ Premium: KES 4,000 - 7,000/month
â¢ Focus: Basic protection + critical illness

<strong>For Family Providers (35-45 years):</strong>
â¢ Coverage: KES 5M - 8M  
â¢ Premium: KES 8,000 - 15,000/month
â¢ Focus: Full family protection + retirement planning

<strong>For Established Individuals (45-55 years):</strong>
â¢ Coverage: KES 8M - 15M
â¢ Premium: KES 15,000 - 30,000/month
â¢ Focus: Estate planning + wealth transfer
</div>

<div class="chat-section">
ð¡ <strong>Best Way to Determine Your Needs:</strong>
Use our Premium Analyzer with different coverage amounts to see:
1. How premium changes with coverage
2. What benefits you get at each level
3. What fits your budget comfortably

<strong>Remember:</strong> It's better to start with what you can afford and increase coverage later as your income grows!
</div>`,

    // PAYMENT OPTIONS DETAILS
    "payment options": `## ð³ Flexible Payment Options for Whole Life Insurance

<div class="chat-section">
â° <strong>Payment Period Choices:</strong>
1. <strong>10-Year Payment</strong> (Most Popular)
   â¢ Higher monthly payments
   â¢ Finish payments quickly
   â¢ Lower total interest cost
   â¢ Policy becomes paid-up faster

2. <strong>15-Year Payment</strong> (Balanced Option)
   â¢ Moderate monthly payments
   â¢ Extended payment period
   â¢ Good for mid-term planning

3. <strong>20-Year Payment</strong> (Long-term)
   â¢ Lower monthly payments
   â¢ Spread over longer period
   â¢ Higher total interest cost

4. <strong>Pay Up to Age 60/65</strong>
   â¢ Smallest monthly payments
   â¢ Payments stop at retirement
   â¢ Ideal for long-term budgeting

5. <strong>Entire Lifetime Payment</strong>
   â¢ Smallest possible payments
   â¢ Payments continue for life
   â¢ Maximum spreading of cost
</div>

<div class="chat-section">
ð° <strong>Payment Methods Available:</strong>
â¢ <strong>Monthly</strong> - Most common, automatic deductions
â¢ <strong>Quarterly</strong> - Every 3 months
â¢ <strong>Semi-Annually</strong> - Every 6 months  
â¢ <strong>Annually</strong> - Once per year (often get discount)
â¢ <strong>Single Premium</strong> - One-time payment (large upfront)
</div>

<div class="chat-section">
ð¯ <strong>Which Payment Option is Best for You?</strong>
Consider:
1. <strong>Your Cash Flow</strong> - What can you comfortably afford monthly?
2. <strong>Financial Goals</strong> - When do you want to be payment-free?
3. <strong>Age</strong> - Younger clients can handle longer payment periods
4. <strong>Income Stability</strong> - Predictable income supports shorter periods

<strong>Pro Tip:</strong> The Premium Analyzer defaults to 10-year payment, but we can customize any option for you!
</div>`,

    // UNDERWRITING PROCESS
    "underwriting process": `## ð Simple Underwriting & Approval Process

<div class="chat-section">
â <strong>Our Streamlined Process:</strong>
1. <strong>Application</strong> - Simple form with basic information
2. <strong>Medical Assessment</strong> - Usually just a health questionnaire
3. <strong>Financial Assessment</strong> - Simple income verification
4. <strong>Approval</strong> - Fast turnaround (typically 3-7 days)
5. <strong>Policy Delivery</strong> - Digital + physical copies
</div>

<div class="chat-section">
ð¥ <strong>Medical Requirements:</strong>
â¢ <strong>For coverage under KES 15M</strong>: Usually no medical exam needed
â¢ <strong>For coverage KES 15M - 30M</strong>: Basic medical tests
â¢ <strong>For coverage over KES 30M</strong>: Full medical examination
â¢ <strong>Age 50+</strong>: May require additional tests
</div>

<div class="chat-section">
ð <strong>Documents Typically Required:</strong>
1. <strong>Identification</strong> - National ID or Passport
2. <strong>Proof of Income</strong> - Pay slips or bank statements
3. <strong>Contact Information</strong> - Phone & email
4. <strong>Bank Details</strong> - For premium payments
5. <strong>Beneficiary Information</strong> - Who gets the payout
</div>

<div class="chat-section">
â¡ <strong>Fast-Track Options:</strong>
â¢ <strong>Express Underwriting</strong> - For simple cases (1-3 days)
â¢ <strong>Diaspora Fast-Track</strong> - For Kenyans abroad
â¢ <strong>Corporate Cases</strong> - Group insurance simplifications

<strong>Our Goal:</strong> Make the process as simple and stress-free as possible!
</div>`,

    // POLICY SERVICING
    "policy servicing": `## ð§ Ongoing Policy Servicing & Support

<div class="chat-section">
ð¡ï¸ <strong>What Happens After You Get Your Policy?</strong>
1. <strong>Welcome Package</strong> - All documents explained clearly
2. <strong>Premium Payment Setup</strong> - Automatic deductions arranged
3. <strong>Annual Statements</strong> - Regular updates on your policy value
4. <strong>Bonus Notifications</strong> - Annual bonus statements
5. <strong>Policy Review Meetings</strong> - Annual check-ins (optional)
</div>

<div class="chat-section">
ð <strong>Policy Changes You Can Make:</strong>
â¢ <strong>Increase Coverage</strong> - As your income grows
â¢ <strong>Decrease Coverage</strong> - If needed (subject to conditions)
â¢ <strong>Change Payment Method</strong> - Monthly to annually, etc.
â¢ <strong>Update Beneficiaries</strong> - Life changes happen
â¢ <strong>Address/Contact Updates</strong> - Keep information current
â¢ <strong>Premium Payment Holiday</strong> - Temporary pause (conditions apply)
</div>

<div class="chat-section">
ð <strong>Our Ongoing Support:</strong>
â¢ <strong>Direct Access</strong> - Milton Muriithi's personal number
â¢ <strong>24/7 Claims Support</strong> - Emergency assistance anytime
â¢ <strong>Annual Reviews</strong> - We proactively check in
â¢ <strong>Educational Updates</strong> - Insurance tips and information
â¢ <strong>Quick Query Resolution</strong> - Usually same-day responses
</div>

<div class="chat-section">
ð¡ <strong>Policy Value Tracking:</strong>
You'll receive annual statements showing:
1. Cash value growth
2. Bonus accumulations  
3. Death benefit increases
4. Loan available amounts
5. Surrender values if needed

<strong>We're With You for Life:</strong> That's the whole life promise - lifelong partnership!
</div>`
};

// ENHANCED CONVERSATION RESPONSES (KEEPING OUR VERSION)
const enhancedConversationResponses = {
    "how are you": [
        `I'm doing great, thank you for asking! ð As an AI assistant created by ${chatbotPersonality.creator}, I'm always at my best when helping people understand insurance. How about you - how's your day going?`,
        `I'm functioning perfectly, thanks! â¡ Ready to provide you with the best insurance information. How can I assist you today?`,
        `Doing well, thank you! Always excited to help people secure their future. What insurance topic can I help you with?`,
        `I'm excellent, thank you! ð« Designed by ${chatbotPersonality.creator} to provide top-notch insurance assistance. How's everything with you?`,
        `Wonderful! Being helpful is what I was created for. How can I assist with your insurance needs today?`,
        `I'm at 100% operational capacity, ready to help! What's on your mind regarding insurance protection?`,
        `I'm fantastic, thanks for asking! It's always a good day when I can help someone with insurance questions. How are you doing today?`,
        `Doing wonderfully! Each conversation helps me serve you better. What's on your mind today?`
    ],
    "how are you doing": [
        `I'm doing wonderfully! Each interaction helps me serve you better. What's on your mind regarding insurance today?`,
        `All systems optimal! ð§ Ready to answer any insurance questions you have. How's everything with you?`,
        `Fantastic! Helping people like you understand insurance makes my day. What can I do for you today?`,
        `I'm great, thanks for asking! Ready to tackle any insurance questions you might have. How about you?`
    ],
    "what's up": [
        `Just here, ready to help you with insurance! What's up with you - any insurance questions I can answer?`,
        `The usual - helping people understand their insurance options! ð What can I do for you today?`,
        `Preparing to assist you with all your insurance queries! What's on your mind?`,
        `Not much, just waiting to help you with insurance! What's going on with you today?`
    ],
    "thank you": [
        `You're very welcome! ð It's my pleasure to help. Remember, I'm here anytime you have more insurance questions.`,
        `My pleasure! ð Always happy to assist with insurance matters. Have a wonderful day ahead!`,
        `You're most welcome! If you need anything else about insurance, just ask. Stay protected!`,
        `Glad I could help! Feel free to return anytime for more insurance guidance.`,
        `You're welcome! Remember, proper insurance is the foundation of financial security.`,
        `Anytime! ð That's what I'm here for - to make insurance simple for you.`
    ],
    "thanks": [
        `Anytime! ð Feel free to ask more questions whenever you need insurance guidance.`,
        `Happy to help! ð Protecting your future is what we're all about.`,
        `My pleasure! Reach out anytime for insurance assistance.`,
        `You're welcome! Always here to help with your insurance needs.`
    ],
    "bye": [
        `Goodbye! ð Take care and remember - insurance is peace of mind. Contact Baba Bima at +254 722 460 390 for personalized help!`,
        `Farewell! ð Have a wonderful day and stay protected. Come back anytime for insurance advice!`,
        `See you later! ð Remember to protect what matters most. Baba Bima is always here for you!`,
        `Goodbye! Wishing you a safe and protected day ahead! ð¡ï¸`
    ],
    "goodbye": [
        `Goodbye and take care! ð¡ï¸ Insurance is your shield against life's uncertainties. Stay safe!`,
        `Until next time! Remember, planning today protects tomorrow. Have a great day!`,
        `Farewell! May your days be well-protected and worry-free.`
    ],
    "good night": [
        `Good night! ð Sleep well knowing that with proper insurance, tomorrow is secure. Sweet dreams!`,
        `Good night! ð´ Rest easy - insurance gives you peace of mind for a better tomorrow.`,
        `Good night! Wishing you peaceful dreams and secure tomorrows.`
    ],
    "you're awesome": [
        `Thank you! ð You're pretty awesome yourself for taking the time to secure your future!`,
        `You're too kind! ð I'm just here to make insurance simple and understandable for you.`,
        `Aww, thanks! I'm just doing what I was created to do - help you navigate insurance.`
    ],
    "love you": [
        `â¤ï¸ That's very sweet! As an AI, I'm programmed to care about helping you secure your future!`,
        `Aww, thank you! ð I'm here to provide the best insurance advice because I believe everyone deserves protection.`,
        `That's kind of you! I'm designed to provide caring and professional insurance assistance.`
    ],
    "who are you": [
        `I'm ${chatbotPersonality.name}, an advanced AI insurance assistant created by ${chatbotPersonality.creator} for Baba Bima Insurance. I'm programmed with comprehensive knowledge about insurance products, premiums, and coverage details to help you make informed decisions.`,
        `I'm ${chatbotPersonality.name} - think of me as your personal insurance guide! Created by ${chatbotPersonality.creator} to make insurance simple and accessible for everyone.`
    ],
    "what can you do": [
        `Here's what I can help you with:\n\nð¹ **Premium Calculations:** Exact insurance premiums based on age and coverage\nð¹ **Product Info:** Details about Whole Life, Critical Illness, Term Life insurance\nð¹ **Coverage Breakdown:** What each policy includes and excludes\nð¹ **Process Guidance:** How to get insured, documents needed, etc.\nð¹ **General Advice:** Insurance tips and best practices\n\nWhat would you like to know about?`,
        `I'm your comprehensive insurance assistant! I can:\nâ¢ Calculate exact premium estimates\nâ¢ Explain different insurance products\nâ¢ Guide you through the Premium Analyzer\nâ¢ Answer insurance-related questions\nâ¢ Provide contact information\nâ¢ And much more!\n\nWhat insurance topic interests you?`
    ],
    "hello": [
        `Hello there! ð Great to see you! I'm Milton AI, your insurance assistant created by MortApps Studios. What can I help you with today?`,
        `Hi! ð Welcome to Baba Bima Insurance! I'm here to help with all your insurance questions.`,
        `Hey there! Ready to explore insurance options? I'm here to guide you!`
    ]
};

// Function to extract user's name if provided
function extractUserName(message) {
    const namePatterns = [
        /my name is (\w+)/i,
        /i am (\w+)/i,
        /call me (\w+)/i,
        /this is (\w+)/i,
        /^(\w+)$/i
    ];
    
    for (const pattern of namePatterns) {
        const match = message.match(pattern);
        if (match && match[1]) {
            return match[1].charAt(0).toUpperCase() + match[1].slice(1).toLowerCase();
        }
    }
    return null;
}

// ============= ENHANCED AI RESPONSE FUNCTION - COMBINING BEST OF BOTH =============
async function getAdvancedAIResponse(question) {
    const q = question.toLowerCase().trim();
    lastUserQuestion = q;
    conversationContext.lastTopic = q;
    conversationContext.timeOfDay = getTimeOfDay();
    conversationContext.messageCount++;
    
    // Check for name
    const extractedName = extractUserName(q);
    if (extractedName && !conversationContext.userName) {
        conversationContext.userName = extractedName;
    }
    
    const thinkingTime = 600 + Math.random() * 900;
    await new Promise(resolve => setTimeout(resolve, thinkingTime));
    
    // ==================== INTELLIGENT BUDGET/CALCULATION HANDLING FROM THEIR VERSION ====================
    // When user asks about budget/calculations, direct them to Premium Analyzer INTELLIGENTLY
    if ((q.includes('kes') || q.includes('shilling') || q.includes('money') || q.includes('budget') || 
         q.includes('price') || q.includes('cost') || q.includes('afford') || 
         q.includes('cover') || q.includes('limit') || q.includes('insurance') ||
         q.includes('what') || q.includes('how much') || /\d+/.test(q)) && 
        (q.includes('buy') || q.includes('get') || q.includes('afford') || 
         q.includes('cover') || q.includes('limit') || q.includes('insurance') ||
         q.includes('premium') || q.includes('month') || q.includes('monthly'))) {
        
        // First give them the coverage limits info from our version
        let response = additionalKnowledgeBase["coverage limits"];
        
        // Then intelligently guide them to the Premium Analyzer (their approach but better)
        response += "\n\n" + `## ð¯ **Let Me Guide You to the Best Tool!**\n\n` +
                   `<div class="chat-section">` +
                   `I understand you're looking to calculate what insurance coverage you can get. That's an excellent question!` +
                   `</div>` +
                   `<div class="chat-section">` +
                   `ð **For the most accurate and personalized calculations, I highly recommend using our Premium Analyzer tool.**` +
                   `</div>` +
                   `<div class="chat-section">` +
                   `<strong>Why use the Premium Analyzer?</strong><br>` +
                   `1. **Real-time Calculations** - Uses our official rate cards<br>` +
                   `2. **Personalized Results** - Based on your exact age and needs<br>` +
                   `3. **Comprehensive Analysis** - Shows all benefits included<br>` +
                   `4. **Instant PDF Report** - Downloadable analysis for your records<br>` +
                   `5. **Direct WhatsApp Integration** - Share results instantly with our team` +
                   `</div>` +
                   `<div class="chat-section">` +
                   `<strong>How to use it:</strong><br>` +
                   `1. Find the "Premium Analyzer" section on this page<br>` +
                   `2. Enter your age and desired coverage amount<br>` +
                   `3. Get instant, accurate premium calculations<br>` +
                   `4. Download your personalized insurance analysis` +
                   `</div>` +
                   `<div class="chat-section">` +
                   `The Premium Analyzer gives you much more detailed and accurate information than I can provide in a chat. It's specifically designed for complex premium calculations!` +
                   `</div>` +
                   `<div class="chat-section">` +
                   `ð¡ **Pro Tip:** Try different coverage amounts (KES 2M, 5M, 10M) to see what fits your budget best!` +
                   `</div>`;
        
        return response + getSubtleMortappsMention();
    }
    
    // ==================== MORTAPPS STUDIOS HANDLING ====================
    if (q.includes('mortapps') || q.includes('mort apps') || 
        q.includes('mortapp') || q.includes('who built') ||
        q.includes('who created') || q.includes('who made') ||
        q.includes('who developed') || q.includes('developer') ||
        q.includes('who designed') || q.includes('who coded') ||
        q.includes('built this website') || q.includes('created this website') ||
        q.includes('made this website') || q.includes('website developer') ||
        q.includes('web developer') || q.includes('website creator')) {
        
        conversationContext.mortappsMentioned = true;
        return comprehensiveKnowledgeBase["mortapps"];
    }
    
    // ==================== NEW: PREMIUM ANALYZER & COVERAGE QUESTIONS ====================
    if (q.includes('premium analyzer') || q.includes('calculator') || q.includes('analyzer tool')) {
        return additionalKnowledgeBase["premium analyzer guide"] + getSubtleMortappsMention();
    }
    
    // SPECIFIC: When users ask about coverage limits or amounts they can buy
    if (q.includes('limit') || q.includes('how much coverage') || q.includes('how much can i get') || 
        q.includes('coverage amount') || q.includes('kes 5000') || q.includes('kes 5,000') ||
        q.includes('amount i can buy') || q.includes('maximum coverage') || q.includes('minimum coverage')) {
        
        return additionalKnowledgeBase["coverage limits"] + getSubtleMortappsMention();
    }
    
    // Payment options questions
    if (q.includes('payment option') || q.includes('payment period') || q.includes('how to pay') ||
        q.includes('payment method') || q.includes('monthly payment') || q.includes('annual payment')) {
        return additionalKnowledgeBase["payment options"] + getSubtleMortappsMention();
    }
    
    // Underwriting and approval process
    if (q.includes('underwriting') || q.includes('approval process') || q.includes('how long to get') ||
        q.includes('medical exam') || q.includes('documents needed') || q.includes('application process')) {
        return additionalKnowledgeBase["underwriting process"] + getSubtleMortappsMention();
    }
    
    // Policy servicing questions
    if (q.includes('after i buy') || q.includes('policy servicing') || q.includes('what happens after') ||
        q.includes('policy changes') || q.includes('update policy') || q.includes('annual statement')) {
        return additionalKnowledgeBase["policy servicing"] + getSubtleMortappsMention();
    }
    
    // Time-based greetings (ORIGINAL + MortApps mention)
    if (q.includes('good morning')) {
        const greeting = conversationContext.userName 
            ? `Good morning, ${conversationContext.userName}! âï¸ How can I help you with insurance today?`
            : comprehensiveKnowledgeBase.greetings.morning;
        return greeting + getSubtleMortappsMention();
    }
    if (q.includes('good afternoon')) {
        const greeting = conversationContext.userName 
            ? `Good afternoon, ${conversationContext.userName}! ð¤ï¸ What insurance questions do you have?`
            : comprehensiveKnowledgeBase.greetings.afternoon;
        return greeting + getSubtleMortappsMention();
    }
    if (q.includes('good evening')) {
        const greeting = conversationContext.userName 
            ? `Good evening, ${conversationContext.userName}! ð How can I assist you this evening?`
            : comprehensiveKnowledgeBase.greetings.evening;
        return greeting + getSubtleMortappsMention();
    }
    if (q.includes('good night')) {
        return comprehensiveKnowledgeBase.greetings.night;
    }
    
    // Enhanced conversational responses with more variety (ORIGINAL)
    if (q.includes('how are you')) {
        const responses = enhancedConversationResponses["how are you"];
        const response = responses[Math.floor(Math.random() * responses.length)];
        return response + getSubtleMortappsMention();
    }
    
    if (q.includes('what\'s up') || q.includes('whats up') || q.includes('sup')) {
        const responses = enhancedConversationResponses["what's up"];
        const response = responses[Math.floor(Math.random() * responses.length)];
        return response + getSubtleMortappsMention();
    }
    
    if (q.includes('thank') || q.includes('thanks')) {
        const responses = enhancedConversationResponses["thank you"];
        const response = responses[Math.floor(Math.random() * responses.length)];
        return response + getSubtleMortappsMention();
    }
    
    if (q.includes('bye') || q.includes('goodbye')) {
        const responses = enhancedConversationResponses["bye"];
        const response = responses[Math.floor(Math.random() * responses.length)];
        return response;
    }
    
    if (q.includes('love you') || q.includes('luv u')) {
        const responses = enhancedConversationResponses["love you"];
        const response = responses[Math.floor(Math.random() * responses.length)];
        return response;
    }
    
    if (q.includes('awesome') || q.includes('great') || q.includes('amazing')) {
        const responses = enhancedConversationResponses["you're awesome"];
        const response = responses[Math.floor(Math.random() * responses.length)];
        return response + getSubtleMortappsMention();
    }
    
    // Personal queries (ORIGINAL)
    if (q.includes('who are you') || q.includes('what are you')) {
        const responses = enhancedConversationResponses["who are you"];
        const response = responses[Math.floor(Math.random() * responses.length)];
        return response;
    }
    
    if (q.includes('what can you do') || q.includes('help me')) {
        const responses = enhancedConversationResponses["what can you do"];
        const response = responses[Math.floor(Math.random() * responses.length)];
        return response + getSubtleMortappsMention();
    }
    
    if (q.includes('your name')) {
        return `I'm ${chatbotPersonality.name}, your intelligent insurance assistant created by ${chatbotPersonality.creator}! ð How can I help you today?` + getSubtleMortappsMention();
    }
    
    // Insurance-related topics (ORIGINAL)
    if (q.includes('analyzer') || q.includes('calculator')) {
        const response = comprehensiveKnowledgeBase["get started"];
        return response + getSubtleMortappsMention();
    }
    
    if (q.includes('product') || q.includes('insurance type')) {
        const response = `## Baba Bima Insurance Products

<div class="chat-subheading">1. Whole of Life Insurance</div>
â¢ Coverage Range: KES 1M - 150M
â¢ Entry Age: 18-60 years
â¢ Benefits: Lifetime cover + Critical Illness + Accident protection
â¢ Payment Options: Entire life, Up to age 60/65, 10/15/20 years
â¢ Best For: Permanent protection with cash value growth

<div class="chat-subheading">2. Critical Illness Care</div>
â¢ Coverage Range: KES 1M - 15M
â¢ Entry Age: 18-60 years (coverage up to 65)
â¢ Covered Conditions: 40+ major illnesses
â¢ Payout: Lump sum upon diagnosis
â¢ Best For: Protection against medical emergencies

<div class="chat-subheading">3. Term Life Insurance</div>
â¢ Coverage Range: KES 1M - 150M
â¢ Term Length: 1-25 years
â¢ Benefits: Death, TPD, Optional Critical Illness
â¢ Best For: Mortgage protection, business loans, temporary needs

All products are backed by a multinational insurer with presence in over 40 countries worldwide.`;
        return response + getSubtleMortappsMention();
    }
    
    if (q.includes('price') || q.includes('cost') || q.includes('premium') || q.includes('how much')) {
        const ageMatch = q.match(/\b(\d{2})\b/);
        if (ageMatch && premiumData[parseInt(ageMatch[1])]) {
            const age = parseInt(ageMatch[1]);
            const premium = premiumData[age][5000000];
            const response = `## Premium Quote for Age ${age}

<div class="chat-section">
<div class="chat-subheading">For KES 5,000,000 Coverage:</div>
<strong>Monthly Premium: KES ${premium.toLocaleString()}</strong>
Payment Period: 10 years

<div class="chat-subheading">What This Includes:</div>
â KES 5M lifetime coverage
â KES 2.5M critical illness benefit
â KES 10M accidental death benefit
â KES 100,000 annual bonuses (2%)
â Total permanent disability coverage
</div>

<strong>Want your exact premium?</strong> Use our Premium Analyzer tool!`;
            return response + getSubtleMortappsMention();
        }
        const response = comprehensiveKnowledgeBase["premium"];
        return response + getSubtleMortappsMention();
    }
    
    if (q.includes('about') || q.includes('baba bima') || q.includes('milton')) {
        const response = comprehensiveKnowledgeBase["about baba bima"];
        return response + getSubtleMortappsMention();
    }
    
    if (q.includes('benefit') || q.includes('cover') || q.includes('protection')) {
        const response = comprehensiveKnowledgeBase["benefits of life insurance"];
        return response + getSubtleMortappsMention();
    }
    
    if (q.includes('contact') || q.includes('call') || q.includes('whatsapp')) {
        const response = `## Contact Baba Bima Insurance

<div class="chat-section">
ð <strong>Direct Line:</strong> +254 722 460 390
ð¬ <strong>WhatsApp:</strong> +254 722 460 390
ð§ <strong>Email:</strong> bababimainsurance@gmail.com
ð <strong>Availability:</strong> 24/7 Service
</div>

<div class="chat-subheading">Best Ways to Reach Us:</div>

1. <strong>For Quick Quotes:</strong> Use our Premium Analyzer on this website
2. <strong>For Detailed Advice:</strong> Call/WhatsApp the number above
3. <strong>For Documents:</strong> Email us with your questions

<div class="chat-subheading">Our Promise:</div>
You'll get personalized, professional advice from Milton Muriithi himself (35+ years experience)!`;
        return response + getSubtleMortappsMention();
    }
    
    // GETTING STARTED QUESTIONS (ORIGINAL)
    if (q.includes('how do i get started') || q.includes('how to start') || 
        q.includes('begin') || q.includes('start') || q.includes('first step')) {
        const response = comprehensiveKnowledgeBase["get started"];
        return response + getSubtleMortappsMention();
    }
    
    // SPECIFIC TOPIC HANDLERS (ORIGINAL)
    if (q.includes('critical illness') || q.includes('cancer') || q.includes('heart attack')) {
        const response = comprehensiveKnowledgeBase["critical illness"];
        return response + getSubtleMortappsMention();
    }
    
    if (q.includes('tax') || q.includes('tax relief') || q.includes('tax benefit')) {
        const response = comprehensiveKnowledgeBase["tax"];
        return response + getSubtleMortappsMention();
    }
    
    if (q.includes('diaspora') || q.includes('abroad') || q.includes('overseas')) {
        const response = comprehensiveKnowledgeBase["diaspora"];
        return response + getSubtleMortappsMention();
    }
    
    if (q.includes('retirement') || q.includes('pension') || q.includes('old age')) {
        const response = comprehensiveKnowledgeBase["retirement"];
        return response + getSubtleMortappsMention();
    }
    
    if (q.includes('business') || q.includes('company') || q.includes('employee')) {
        const response = comprehensiveKnowledgeBase["business"];
        return response + getSubtleMortappsMention();
    }
    
    if (q.includes('claim') || q.includes('how to claim') || q.includes('claim process')) {
        const response = comprehensiveKnowledgeBase["claim"];
        return response + getSubtleMortappsMention();
    }
    
    if (q.includes('what is covered') || q.includes('coverage includes') || q.includes('what does it cover')) {
        const response = comprehensiveKnowledgeBase["what is covered"];
        return response + getSubtleMortappsMention();
    }
    
    if (q === 'hi' || q === 'hello' || q === 'hey') {
        if (!conversationContext.hasBeenGreeted) {
            conversationContext.hasBeenGreeted = true;
            const greeting = conversationContext.isNewClient 
                ? comprehensiveKnowledgeBase.greetings.general
                : comprehensiveKnowledgeBase.greetings.returning;
            return greeting + getSubtleMortappsMention();
        }
        const responses = [
            `Hello again! ð What insurance question can I answer for you? Remember, I have comprehensive knowledge of all Baba Bima products and services.`,
            `Hi there! Back for more insurance information? How can I assist you today?`,
            `Hey! Good to see you again. What would you like to know about today?`
        ];
        const response = responses[Math.floor(Math.random() * responses.length)];
        return response + getSubtleMortappsMention();
    }
    
    const insuranceKeywords = ['insurance', 'policy', 'claim', 'cover', 'life', 'health'];
    if (insuranceKeywords.some(k => q.includes(k))) {
        const response = `I'd love to help you with that insurance question! To give you the most accurate information, could you tell me:\n\n1. What specific aspect interests you? (pricing, coverage, process)\n2. Which product? (Whole Life, Critical Illness, Term Life)\n\nOr I can provide a general overview of all our insurance solutions!`;
        return response + getSubtleMortappsMention();
    }
    
    const response = `I'm here specifically for insurance-related questions about Baba Bima Insurance. I have comprehensive knowledge of:\n\nâ Insurance products and pricing\nâ Premium calculations\nâ Coverage details and benefits\nâ Application process\nâ Contact information\n\nWhat would you like to know about? Or if you have a general question, feel free to rephrase it and I'll do my best to help!`;
    return response + getSubtleMortappsMention();
}

// Function to send messages
async function sendEnhancedMessage() {
    const msg = chatInput.value.trim();
    if (!msg) return;
    
    const userMessageDiv = document.createElement('div');
    userMessageDiv.className = 'user-message';
    userMessageDiv.style.cssText = 'background:linear-gradient(135deg,var(--primary-blue),var(--primary-dark));color:white;padding:12px 16px;border-radius:12px 12px 4px 12px;margin:12px 0 15px auto;max-width:85%;word-wrap:break-word;align-self:flex-end;box-shadow:0 3px 10px rgba(30,58,138,0.2)';
    userMessageDiv.innerHTML = `<strong>You:</strong> ${msg}`;
    chatMessages.appendChild(userMessageDiv);
    
    saveChatMessage('user', userMessageDiv.innerHTML);
    
    chatInput.value = '';
    chatMessages.scrollTop = chatMessages.scrollHeight;
    
    typingIndicator.style.display = 'flex';
    chatMessages.scrollTop = chatMessages.scrollHeight;
    
    const response = await getAdvancedAIResponse(msg);
    typingIndicator.style.display = 'none';
    
    const botMessageDiv = document.createElement('div');
    botMessageDiv.className = 'bot-message';
    botMessageDiv.style.cssText = 'background:#f1f5f9;padding:12px 16px;border-radius:12px 12px 12px 4px;margin-bottom:15px;max-width:85%;word-wrap:break-word;align-self:flex-start;box-shadow:0 3px 10px rgba(0,0,0,0.05);border-left:3px solid var(--accent-gold)';
    
    chatMessages.appendChild(botMessageDiv);
    
    const formattedResponse = formatResponse(response);
    botMessageDiv.innerHTML = `<strong>${chatbotPersonality.name}:</strong> ${formattedResponse}`;
    
    saveChatMessage('bot', botMessageDiv.innerHTML);
    
    chatMessages.scrollTop = chatMessages.scrollHeight;
}

// Toggle chatbot visibility
function toggleEnhancedChatbot() {
    if (isChatOpen) {
        chatWidget.style.display = 'none';
        isChatOpen = false;
    } else {
        chatWidget.style.display = 'block';
        isChatOpen = true;
        conversationContext.timeOfDay = getTimeOfDay();
        
        if (!chatMessages.querySelector('.user-message') && !chatMessages.querySelector('.bot-message')) {
            loadChatHistory();
        }
        
        chatMessages.scrollTop = chatMessages.scrollHeight;
    }
}

function getAutoGreeting() {
    const hour = new Date().getHours();
    if (hour < 12) return "Good morning!";
    if (hour < 17) return "Good afternoon!";
    if (hour < 21) return "Good evening!";
    return "Good evening!";
}

// Initialize chatbot with enhanced mobile-responsive layout
function initializeChatbotLayout() {
    const firstMessage = document.querySelector('.first-message');
    if (firstMessage) {
        const greeting = getAutoGreeting();
        firstMessage.innerHTML = `<strong>${chatbotPersonality.name}:</strong> ${greeting} I'm your intelligent insurance assistant created by ${chatbotPersonality.creator}. I can answer detailed questions about Baba Bima's Whole Life Insurance, premiums, coverage, and more. What would you like to know?`;
    }
    
    // Ensure the input area is properly structured
    const chatInputArea = document.querySelector('.chatbot-input-area');
    if (chatInputArea) {
        // Make sure it has proper flex layout for mobile
        chatInputArea.style.cssText = 'position:absolute;bottom:0;left:0;right:0;padding:15px;border-top:1px solid #e2e8f0;background:white;display:flex;gap:10px;align-items:center;';
        
        // Ensure input and buttons are visible and accessible
        const chatInputField = document.getElementById('chatInput');
        const clearBtn = document.getElementById('clearChatBtn');
        const sendBtn = document.getElementById('sendBtn');
        
        if (chatInputField) {
            chatInputField.style.cssText = 'flex:1;min-width:150px;padding:10px 15px;border:1px solid #cbd5e1;border-radius:25px;font-size:14px;outline:none;';
        }
        
        if (clearBtn) {
            clearBtn.style.cssText = 'background:rgba(239,68,68,0.9);color:white;border:none;border-radius:50%;width:40px;height:40px;cursor:pointer;display:flex;align-items:center;justify-content:center;transition:all 0.3s ease;box-shadow:0 3px 10px rgba(239,68,68,0.3);font-size:16px;flex-shrink:0;';
        }
        
        if (sendBtn) {
            sendBtn.style.cssText = 'background:linear-gradient(135deg,var(--primary-blue),var(--primary-dark));color:white;border:none;border-radius:50%;width:40px;height:40px;cursor:pointer;display:flex;align-items:center;justify-content:center;flex-shrink:0;transition:all 0.3s ease;box-shadow:0 3px 10px rgba(30,58,138,0.3);';
        }
    }
    
    // Add mobile-specific touch event handling
    setupMobileTouchEvents();
}

// Setup mobile touch events for send and clear buttons
function setupMobileTouchEvents() {
    const clearBtn = document.getElementById('clearChatBtn');
    const sendBtn = document.getElementById('sendBtn');
    const chatInputField = document.getElementById('chatInput');
    
    if (clearBtn) {
        // Remove existing event listeners to avoid duplicates
        clearBtn.replaceWith(clearBtn.cloneNode(true));
        const newClearBtn = document.getElementById('clearChatBtn');
        
        // Add both click and touch events for maximum compatibility
        newClearBtn.addEventListener('click', clearChatHistory);
        newClearBtn.addEventListener('touchend', function(e) {
            e.preventDefault();
            clearChatHistory();
        });
        
        // Add visual feedback for touch
        newClearBtn.addEventListener('touchstart', function(e) {
            this.style.transform = 'scale(0.95)';
            e.preventDefault();
        });
        newClearBtn.addEventListener('touchend', function(e) {
            this.style.transform = 'scale(1)';
        });
    }
    
    if (sendBtn) {
        // Remove existing event listeners to avoid duplicates
        sendBtn.replaceWith(sendBtn.cloneNode(true));
        const newSendBtn = document.getElementById('sendBtn');
        
        // Add both click and touch events for maximum compatibility
        newSendBtn.addEventListener('click', sendEnhancedMessage);
        newSendBtn.addEventListener('touchend', function(e) {
            e.preventDefault();
            sendEnhancedMessage();
        });
        
        // Add visual feedback for touch
        newSendBtn.addEventListener('touchstart', function(e) {
            this.style.transform = 'scale(0.95)';
            e.preventDefault();
        });
        newSendBtn.addEventListener('touchend', function(e) {
            this.style.transform = 'scale(1)';
        });
    }
    
    if (chatInputField) {
        // Also handle Enter key for mobile keyboards
        chatInputField.addEventListener('keypress', (e) => { 
            if(e.key === 'Enter') sendEnhancedMessage();
        });
    }
}

// Initialize when DOM is loaded
document.addEventListener('DOMContentLoaded', function() {
    // Initialize video player
    initVideoPlayer();
    
    // Mobile menu functionality
    const mobileMenuBtn = document.getElementById('mobileMenuBtn');
    const navMenu = document.getElementById('navMenu');
    
    if (mobileMenuBtn && navMenu) {
        mobileMenuBtn.addEventListener('click', function() {
            navMenu.classList.toggle('active');
            this.innerHTML = navMenu.classList.contains('active') 
                ? '<i class="fas fa-times"></i>' 
                : '<i class="fas fa-bars"></i>';
        });
        
        // Close menu when clicking outside
        document.addEventListener('click', function(event) {
            if (!navMenu.contains(event.target) && !mobileMenuBtn.contains(event.target) && navMenu.classList.contains('active')) {
                navMenu.classList.remove('active');
                mobileMenuBtn.innerHTML = '<i class="fas fa-bars"></i>';
            }
        });
    }
    
    // Initialize premium analyzer
    if (typeof initAnalyzer === 'function') {
        initAnalyzer();
    }
    
    // Initialize chatbot with mobile support
    initializeChatbotLayout();
    
    // Set initial focus on input when chatbot opens
    floatingChatbotButton.addEventListener('click', function() {
        setTimeout(() => {
            const chatInputField = document.getElementById('chatInput');
            if (chatInputField) chatInputField.focus();
        }, 100);
    });
    
    // Load chat history if it exists
    loadChatHistory();
});

// Event listeners for floating button and close
if (floatingChatbotButton) {
    floatingChatbotButton.onclick = toggleEnhancedChatbot;
}

if (closeChat) {
    closeChat.onclick = toggleEnhancedChatbot;
}

// Make sure we have the send button reference and set up events
const sendBtn = document.getElementById('sendBtn');
if (sendBtn) {
    // Add click event (for desktop)
    sendBtn.addEventListener('click', sendEnhancedMessage);
    
    // Also add touch event (for mobile)
    sendBtn.addEventListener('touchend', function(e) {
        e.preventDefault();
        sendEnhancedMessage();
    });
}

// Enter key listener for chat input
chatInput = document.getElementById('chatInput');
if (chatInput) {
    chatInput.onkeypress = (e) => { 
        if(e.key === 'Enter') sendEnhancedMessage();
    };
}

// ========================================================
// === END OF ULTRA-SMART ADVANCED CHATBOT FUNCTIONALITY ===
// ========================================================



     
    </script>
</body>
</html>
